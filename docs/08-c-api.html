<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>8. C++ | Документация торговых роботов компании &quot;Викинг&quot;</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <link rel="icon" href="/bot-doc/favicon.ico">
    <meta name="description" content="Руководство пользователя, описание алгоритма и API">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/bot-doc/assets/css/0.styles.cb6403b3.css" as="style"><link rel="preload" href="/bot-doc/assets/js/app.e81ab8fa.js" as="script"><link rel="preload" href="/bot-doc/assets/js/3.5b3b6265.js" as="script"><link rel="preload" href="/bot-doc/assets/js/13.1823ce22.js" as="script"><link rel="preload" href="/bot-doc/assets/js/10.8c8ad779.js" as="script"><link rel="prefetch" href="/bot-doc/assets/js/11.55febb22.js"><link rel="prefetch" href="/bot-doc/assets/js/12.d623e0fe.js"><link rel="prefetch" href="/bot-doc/assets/js/14.ad5d64ed.js"><link rel="prefetch" href="/bot-doc/assets/js/15.9af162a9.js"><link rel="prefetch" href="/bot-doc/assets/js/16.9bde9826.js"><link rel="prefetch" href="/bot-doc/assets/js/17.ee50ca3e.js"><link rel="prefetch" href="/bot-doc/assets/js/18.87554097.js"><link rel="prefetch" href="/bot-doc/assets/js/19.9fcead24.js"><link rel="prefetch" href="/bot-doc/assets/js/4.69016f4b.js"><link rel="prefetch" href="/bot-doc/assets/js/5.74b65c17.js"><link rel="prefetch" href="/bot-doc/assets/js/6.8be4ae1f.js"><link rel="prefetch" href="/bot-doc/assets/js/7.fcd9b261.js"><link rel="prefetch" href="/bot-doc/assets/js/8.18baa8b6.js"><link rel="prefetch" href="/bot-doc/assets/js/9.f3d86c02.js"><link rel="prefetch" href="/bot-doc/assets/js/vendors~docsearch.30c42ed6.js">
    <link rel="stylesheet" href="/bot-doc/assets/css/0.styles.cb6403b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bot-doc/" class="home-link router-link-active"><img src="/bot-doc/images/vkg_logo.svg" alt="Документация торговых роботов компании &quot;Викинг&quot;" class="logo"> <span class="site-name can-hide">Документация торговых роботов компании &quot;Викинг&quot;</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bot-doc/docs/" class="nav-link router-link-active">
  Документация
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bot-doc/docs/" class="nav-link router-link-active">
  Документация
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bot-doc/docs/01-change-history.html" class="sidebar-link">1. История изменений</a></li><li><a href="/bot-doc/docs/02-introduction.html" class="sidebar-link">2. Введение</a></li><li><a href="/bot-doc/docs/03-getting-started.html" class="sidebar-link">3. Начало работы</a></li><li><a href="/bot-doc/docs/04-creating-connection.html" class="sidebar-link">4. Добавление подключений</a></li><li><a href="/bot-doc/docs/05-params-description.html" class="sidebar-link">5. Описание параметров</a></li><li><a href="/bot-doc/docs/06-algorithm-comments.html" class="sidebar-link">6. Примечания к алгоритму</a></li><li><a href="/bot-doc/docs/07-order-error.html" class="sidebar-link">7. Ошибки заявок</a></li><li><a href="/bot-doc/docs/08-c-api.html" aria-current="page" class="active sidebar-link">8. C++</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-1-редактор-формул" class="sidebar-link">8.1. Редактор формул</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-2-важно" class="sidebar-link">8.2. Важно</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-3-доступ-к-биржевым-данным-по-финансовым-инструментам" class="sidebar-link">8.3. Доступ к биржевым данным по финансовым инструментам</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-4-доступ-и-изменение-полеи-инструмента-портфеля" class="sidebar-link">8.4. Доступ и изменение полей инструмента портфеля</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-5-доступ-и-изменение-полеи-портфеля" class="sidebar-link">8.5. Доступ и изменение полей портфеля</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-6-доступ-и-изменение-позиции-транзакционного-подключения" class="sidebar-link">8.6. Доступ и изменение позиций транзакционного подключения</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-7-дополнительные-классы-структуры-функции-и-константы" class="sidebar-link">8.7. Дополнительные классы, структуры, функции и константы</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-8-индикаторы-и-математическая-статистика" class="sidebar-link">8.8. Индикаторы и математическая статистика</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-9-примеры-доступа-к-параметрам-портфеля-инструмента-сделки-позиции" class="sidebar-link">8.9. Примеры доступа к параметрам портфеля, инструмента, сделки, позиций</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-10-примеры-использования-функции-и-классов" class="sidebar-link">8.10. Примеры использования функций и классов</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-11-примеры-написания-ratio-buy-sell-formula" class="sidebar-link">8.11. Примеры написания Ratio buy/sell formula</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/08-c-api.html#_8-12-примеры-использования-индикаторов" class="sidebar-link">8.12. Примеры использования индикаторов</a></li></ul></li><li><a href="/bot-doc/docs/09-faq.html" class="sidebar-link">9. Часто задаваемые вопросы</a></li><li><a href="/bot-doc/docs/10-api.html" class="sidebar-link">10.API фронта 2.0</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_8-c" tabindex="-1"><a href="#_8-c" class="header-anchor">#</a> 8. C++ <div class="anchor-container" data-v-72af3cd3><span id="c++" data-v-72af3cd3></span></div></h1> <h2 id="_8-1-редактор-формул" tabindex="-1"><a href="#_8-1-редактор-формул" class="header-anchor">#</a> 8.1. Редактор формул <div class="anchor-container" data-v-72af3cd3><span id="редактор-формул" data-v-72af3cd3></span></div></h2> <p>Редактировать формулы на C++ вы можете во вкладке <code>Formulas</code> в окне настроек портфеля, которое открывается при нажатии на иконку <img src="/bot-doc/assets/img/settings_black.d5b3bfbb.svg" width="16" height="16"> :</p> <p>Написание формул возможно как для всего портфеля, так и для каждого инструмента в отдельности.</p> <p>В первом случае будут отображены поля <a href="/bot-doc/docs/05-params-description.html#p.trade_formula">Trade formula</a>, <a href="/bot-doc/docs/05-params-description.html#p.ext_field1_">Extra field#1</a> и <a href="/bot-doc/docs/05-params-description.html#p.ext_field2_">Extra field#2</a>.
Во втором <a href="/bot-doc/docs/05-params-description.html#_5-3-9-count-formula">Count formula</a>, <a href="/bot-doc/docs/05-params-description.html#_5-3-28-ratio-buy-formula">Ratio buy formula</a>, <a href="/bot-doc/docs/05-params-description.html#_5-3-29-ratio-sell-formula">Ratio sell formula</a>.</p> <p>В редакторе формул существует возможность тестового выполнения выбранной формулы (кнопка <code>Test</code>, при этом в строку компиляции добавляется флаг <code>-DDEBUG</code>) и на момент вычисления формулы создаётся временная копия портфеля, НО если вы в формуле изменяете значения полей портфеля, и у вас существует портфель с тем же именем, то изменения применятся к этому портфелю.</p> <p>Доступно редактирование как включенных,  так и выключенных формул.</p> <h2 id="_8-2-важно" tabindex="-1"><a href="#_8-2-важно" class="header-anchor">#</a> 8.2. Важно <div class="anchor-container" data-v-72af3cd3><span id="важно" data-v-72af3cd3></span></div></h2> <p>При написании формул на языке программирования C++ на код накладываются некоторые ограничения:</p> <ul><li>Вы пишете только тело соответствующих функций, все функции должны возвращать значение типа <code>double</code>;</li> <li>Запрещено использование некоторых символов и слов: <code>\001</code>, <code>#nl</code>, <code>#tab</code>;</li> <li>Вы можете получить доступ к любому портфелю робота, к инструменту портфеля робота, а также к инструменту биржи, который фигурирует хотя бы в одном из ваших порфтелей;</li> <li>Вы можете изменять значения некоторых полей портфелей и инструментов портфелей. При изменении значений каких-то полей, вы можете &quot;сломать&quot; работу штатного алгоритма робота, имейте это в виду. В связи с этим для экстренного отключения торговли и выключения всех расчётов по формулам в меню действий с портфелями предусмотрен пункт <code>Stop formulas</code>;</li> <li>Портфель (структура <code>portfolio</code>) содержит метод <code>data()</code>, который позволяет получить доступ к словарю, в который можно сохранять данные между вызовами формул (в API эти данные НЕ доступны, при выключении робота значения НЕ сохраняются);</li> <li>Портфель (структура <code>portfolio</code>) содержит методы <code>uf0(), ..., uf19()</code> и <code>set_uf0(), ..., set_uf19()</code>, которые позволяют получить доступ к пользовательским полям, которые НЕ используюстя в штатном алгоритме робота и предназначены для исползования пользователем (значения этих полей доступны в API, это такие же поля портфеля, как и все остальные, но зарезервированные для пользователя).</li></ul> <p><strong>Важно:</strong> если значение поля какой-либо бумаги еще не было получено с биржи или для бумаги с данной биржи нельзя получить значение этого поля, то вы получите 0. Нужно понимать что, например, на пустом стакане вы можете получить 0 в качестве цены бида или оффера, поэтому всегда проверяйте значения на равенство нулю в тех ситуациях, где это критично (например, при делении или при нахождении среднего арифметического бида и оффера).</p> <p><strong>Важно:</strong> настоятельно НЕ рекомендуется пользоваться недокументированными особенностями работы робота, т.к. недокументированное поведение робота может быть изменено без предупреждения.</p> <p><strong>Важно:</strong> если формулы изменяют значения каких-то параметров портфеля, которые изменяются алгоритмом, то можно легко получить &quot;неожиданное&quot; поведение.</p> <p><strong>Важно:</strong> при написании формул вы пишете код на небезопасном языке программитрования C++, своими действиями вы легко можете &quot;положить&quot; робота, только вы несете ответственность за корректность работы вашего кода.</p> <p><strong>Важно:</strong> везде в роботе количества в заявках/сделках и в позициях - это целые числа, сделано это для того, чтобы не иметь проблем с операциями над вещественными числами. В С++ API количества и позиции тоже целые числа, по той же причине. Для конвертации количеств и
позиций в ту же размерность, в которой они отображаются на сайтах бирж (для тех бирж где возможны дробные значения в данных полях), в тех объектах, которых касается описанная выше проблема, есть поле <code>lot_size</code>. Для перевода из целых в дробные необходимо исходное значение
умножить на <code>lot_size</code>, а для перевода из дробных в целые необходимо исходное значение разделить на <code>lot_size</code>. Для параметров портфеля и бумаг портфеля, которых касается <code>lot_size</code>, есть соответствующие пометки в описании этих параметров.</p> <h2 id="_8-3-доступ-к-биржевым-данным-по-финансовым-инструментам" tabindex="-1"><a href="#_8-3-доступ-к-биржевым-данным-по-финансовым-инструментам" class="header-anchor">#</a> 8.3. Доступ к биржевым данным по финансовым инструментам <div class="anchor-container" data-v-72af3cd3><span id="Доступ-к-биржевым-данным-по-финансовым-инструментам" data-v-72af3cd3></span><span id="доступ-к-биржевым-данным-по-финансовым-инструментам" data-v-72af3cd3></span></div></h2> <table><thead><tr><th>Функция</th> <th>Описание</th></tr></thead> <tbody><tr><td>struct security get_security(const std::string&amp; s)</td> <td>получить инструмент по его <a href="/bot-doc/docs/05-params-description.html#_5-3-1-seckey">SecKey</a> s</td></tr> <tr><td>struct security get_security(const char* s)</td> <td>получить инструмент по его <a href="/bot-doc/docs/05-params-description.html#_5-3-1-seckey">SecKey</a> s</td></tr> <tr><td>struct security get_security()</td> <td>получить инструмент, соответствующий главной бумаге текущего портфеля</td></tr> <tr><td>struct security get_security(const security_fields&amp; sf)</td> <td>получить инструмент, соответствующий заданной бумаге портфеля</td></tr></tbody></table> <p>Методы <code>security</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>double theor_price()</td> <td>расчетная цена, есть только для опционов</td></tr> <tr><td>double bid()</td> <td>лучшая цена на покупку</td></tr> <tr><td>double offer()</td> <td>лучшая цена на продажу</td></tr> <tr><td>double mid_price()</td> <td>среднее арифметическое лучших цена на покупку и продажу, если одной из цен нет, то это вторая цена, если нет обеих цен, то будет выброшено исключение <code>std::range_error</code></td></tr> <tr><td>double exp_date()</td> <td>дата экспирации, в формате epoch</td></tr> <tr><td>double strike()</td> <td>цена страйк, есть только у опционов</td></tr> <tr><td>long long amount_offer()</td> <td>объем оффера в лотах</td></tr> <tr><td>long long amount_bid()</td> <td>объем бида в лотах</td></tr> <tr><td>double limit_up()</td> <td>разрешенный верхний лимит цены</td></tr> <tr><td>double limit_down()</td> <td>разрешенный нижний лимит цены</td></tr> <tr><td>int trading_status()</td> <td>статус торгуемости бумаги на бирже (битовая маска, возможные взведенные биты <a href="#__TRADING_CAN_PLACE__">TRADING_CAN_PLACE</a> и <a href="#__TRADING_CAN_CANCEL__">TRADING_CAN_CANCEL</a>, <a href="#__sec_status_check__">пример</a>)</td></tr> <tr><td>int conn_online()</td> <td>стауст активности маркет-дата подключения в роботе (битовая маска, возможные взведенные биты <a href="#__MARKET_DATA_BESTS_ONLINE__">MARKET_DATA_BESTS_ONLINE</a> и <a href="#__MARKET_DATA_OB_ONLINE__">MARKET_DATA_OB_ONLINE</a>, <a href="#__sec_status_check__">пример</a>)</td></tr> <tr><td>double min_step()</td> <td>минимальный шаг цены</td></tr> <tr><td>double lot_round()</td> <td>количество ценных бумаг в одном стандартном лоте</td></tr> <tr><td>double lot_size()</td> <td>множитель для конвертации дробных объемов в целые</td></tr> <tr><td>double funding_rate()</td> <td>ставка фондирования</td></tr> <tr><td>long long funding_time()</td> <td>время следующего фондирования в формате epoch</td></tr> <tr><td>const spb_commons&amp; spb_common()</td> <td>структура с полями, описанными ниже</td></tr> <tr><td>order_book orderbook()</td> <td>структура с методами, описанными ниже</td></tr></tbody></table> <p>Поля структуры <code>spb_commons</code> (значения будут отличны от нуля только для инструментов с <code>SPBEX</code>):</p> <table><thead><tr><th>Название</th> <th>Тип</th> <th>Описание</th></tr></thead> <tbody><tr><td>price_last</td> <td>double</td> <td>цена последней сделки</td></tr> <tr><td>price_open</td> <td>double</td> <td>цена первой сделки за сессию</td></tr> <tr><td>price_close</td> <td>double</td> <td>официальная цена закрытия</td></tr> <tr><td>price_high</td> <td>double</td> <td>сделка с максимальной ценой</td></tr> <tr><td>price_low</td> <td>double</td> <td>сделка с минимальной ценой</td></tr> <tr><td>price_auction_close_prev</td> <td>double</td> <td>цена аукциона закрытия предыдущего дня</td></tr> <tr><td>price_halt</td> <td>double</td> <td>цена для определения приостановок</td></tr> <tr><td>price_official_min_time</td> <td>long long</td> <td>время последнего изменения минимальной текущей цены</td></tr> <tr><td>price_indicative</td> <td>double</td> <td>текущая цена рынка</td></tr> <tr><td>price_close_prev</td> <td>double</td> <td>официальная цена закрытия предыдущего дня</td></tr> <tr><td>price_official</td> <td>double</td> <td>официальная цена онлайн (текущая цена)</td></tr> <tr><td>price_vwap_day_prev</td> <td>double</td> <td>средневзвешенная цена основной сессии предыдущего дня</td></tr> <tr><td>price_vwap_day</td> <td>double</td> <td>средневзвешенная цена основной сессии текущего дня</td></tr> <tr><td>price_current</td> <td>double</td> <td>текущая котировка</td></tr> <tr><td>price_average</td> <td>double</td> <td>средневзвешенная цена</td></tr> <tr><td>time_last</td> <td>long long</td> <td>время последней сделки</td></tr> <tr><td>price_prev_period_close</td> <td>double</td> <td>цена последней сделки предыдущего дня</td></tr></tbody></table> <p><a href="#__Example1__"><em>Пример:</em></a> Пример доступа к полям структуры <code>spb_commons</code>.</p> <p>Методы <code>order_book</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>bool is_available()</td> <td>доступен ли в данный момент для данной бумаги стакан</td></tr> <tr><td>bool has_next_bid()</td> <td>есть ли еще бид в списке бидов</td></tr> <tr><td>bool has_next_offer()</td> <td>есть ли еще оффер в списке офферов</td></tr> <tr><td>std::pair next_bid()</td> <td>получить текущий бид в формате пара: цена + объем (если его нет, вы получите исключение std::out_of_range) и передвинуть указатель на следующий бид в списке</td></tr> <tr><td>std::pair next_offer()</td> <td>получить текущий оффер в формате пара: цена + объем (если его нет, вы получите исключение std::out_of_range) и передвинуть указатель на следующий оффер в списке</td></tr></tbody></table> <p>По своей сути <code>order_book</code> является итератором сразу для двух списков: бидов и офферов, оба списка проходятся в порядке от лучшей цены в сторону худших. Вы можете получить только следующую цену в списке, если нужно вернуться к предыдущей - сохраняйте ее или получите <code>order_book</code> заново.</p> <p><a href="https://fkviking.github.io/bot-doc08-c-api.md#_8-8-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BA-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%B0%D0%BC-%D0%BF%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8F-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0-%D1%81%D0%B4%D0%B5%D0%BB%D0%BA%D0%B8-%D0%BF%D0%BE%D0%B7%D0%B8%D1%86%D0%B8%D0%B8" target="_blank" rel="noopener noreferrer"><em>Пример:</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> использования методов структуры <code>order_book</code>.</p> <h2 id="_8-4-доступ-и-изменение-полеи-инструмента-портфеля" tabindex="-1"><a href="#_8-4-доступ-и-изменение-полеи-инструмента-портфеля" class="header-anchor">#</a> 8.4. Доступ и изменение полей инструмента портфеля <div class="anchor-container" data-v-72af3cd3><span id="доступ-и-изменение-полей-инструмента-портфеля" data-v-72af3cd3></span></div></h2> <table><thead><tr><th>Функция</th> <th>Описание</th></tr></thead> <tbody><tr><td>struct security_fields get_security_fields(const std::string&amp; p, const std::string&amp; s)</td> <td>получить бумагу портфеля с именем p с <a href="/bot-doc/docs/05-params-description.html#_5-3-1-seckey">SecKey</a> s</td></tr> <tr><td>struct security_fields get_security_fields()</td> <td>получить главную бумагу текущего портфеля</td></tr> <tr><td>struct security_fields get_security_fields(const std::string&amp; s)</td> <td>получить бумагу текущего портфеля с <a href="/bot-doc/docs/05-params-description.html#_5-3-1-seckey">SecKey</a> s</td></tr></tbody></table> <p>Методы <code>security_fields</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>order_pool orders()</td> <td>получить пул заявок</td></tr> <tr><td>long long sec_type()</td> <td>получить &quot;Exchange&quot; инструмента портфеля</td></tr> <tr><td>std::string sec_key()</td> <td>получить &quot;SecKey&quot; инструмента портфеля</td></tr> <tr><td>int put()</td> <td>получить &quot;Put&quot; инструмента портфеля</td></tr> <tr><td>double lot_size()</td> <td>получить множитель для конвертации дробных объемов в целые инструмента портфеля</td></tr> <tr><td>long long pos()</td> <td>получить &quot;Curpos&quot; инструмента портфеля</td></tr> <tr><td>long long count()</td> <td>получить &quot;Count&quot; инструмента портфеля</td></tr> <tr><td>int depth_ob()</td> <td>получить &quot;Depth OB&quot; инструмента портфеля</td></tr> <tr><td>int ob_c_p_t()</td> <td>получить &quot;Calc price OB&quot; инструмента портфеля</td></tr> <tr><td>int ob_t_p_t()</td> <td>получить &quot;Trading price OB&quot; инструмента портфеля</td></tr> <tr><td>int decimals()</td> <td>получить &quot;Decimals&quot; инструмента портфеля</td></tr> <tr><td>double d_pg()</td> <td>получить &quot;date pagination&quot; инструмента портфеля</td></tr> <tr><td>std::string client_code()</td> <td>получить &quot;Client code&quot; инструмента портфеля</td></tr> <tr><td>bool is_first()</td> <td>получить &quot;Is first&quot; инструмента портфеля</td></tr> <tr><td>int on_buy()</td> <td>получить &quot;On buy&quot; инструмента портфеля</td></tr> <tr><td>int leverage()</td> <td>получить &quot;Leverage&quot; инструмента портфеля</td></tr> <tr><td>std::string sec_board()</td> <td>получить &quot;SecBoard&quot; инструмента портфеля</td></tr> <tr><td>std::string sec_code()</td> <td>получить &quot;SecCode&quot; инструмента портфеля</td></tr> <tr><td>int count_type()</td> <td>получить &quot;Count type&quot; инструмента портфеля</td></tr> <tr><td>double k()</td> <td>получить &quot;k&quot; инструмента портфеля</td></tr> <tr><td>bool sle()</td> <td>получить &quot;SLE&quot; инструмента портфеля</td></tr> <tr><td>double sl()</td> <td>получить &quot;SL&quot; инструмента портфеля</td></tr> <tr><td>double tp()</td> <td>получить &quot;TP&quot; инструмента портфеля</td></tr> <tr><td>double k_sl()</td> <td>получить &quot;k_sl&quot; инструмента портфеля</td></tr> <tr><td>bool te()</td> <td>получить &quot;TE&quot; инструмента портфеля</td></tr> <tr><td>int timer()</td> <td>получить &quot;Timer&quot; инструмента портфеля</td></tr> <tr><td>int ratio_sign()</td> <td>получить &quot;Ratio sign&quot; инструмента портфеля</td></tr> <tr><td>int ratio_type()</td> <td>получить &quot;Ratio type&quot; инструмента портфеля</td></tr> <tr><td>double ratio_b()</td> <td>получить &quot;Ratio&quot; для расчета покупки инструмента портфеля</td></tr> <tr><td>double ratio_s()</td> <td>получить &quot;Ratio&quot; для расчета продажи инструмента портфеля</td></tr> <tr><td>double percent_of_quantity()</td> <td>получить &quot;Percent of quantity&quot; инструмента портфеля</td></tr> <tr><td>double fin_res_mult()</td> <td>получить &quot;Fin res multiplier&quot; инструмента портфеля</td></tr> <tr><td>int comission_sign()</td> <td>получить &quot;Commission type&quot; инструмента портфеля</td></tr> <tr><td>double comission()</td> <td>получить &quot;Commission&quot; инструмента портфеля</td></tr> <tr><td>bool mm()</td> <td>получить &quot;MM&quot; инструмента портфеля</td></tr> <tr><td>bool maker()</td> <td>получить &quot;Only maker&quot; инструмента портфеля</td></tr> <tr><td>bool move_limits()</td> <td>получить &quot;FUT move limits&quot; инструмента портфеля</td></tr> <tr><td>bool move_limits1()</td> <td>получить &quot;SPOT move limits&quot; инструмента портфеля</td></tr> <tr><td>int depth_ob()</td> <td>получить &quot;Depth OB&quot; инструмента портфеля</td></tr> <tr><td>int ob_c_p_t()</td> <td>получить &quot;Calc price OB&quot; инструмента портфеля</td></tr> <tr><td>int ob_t_p_t()</td> <td>получить &quot;Trading price OB&quot; инструмента портфеля</td></tr> <tr><td>double mc_level_to0()</td> <td>получить &quot;Level to0&quot; инструмента портфеля</td></tr> <tr><td>double mc_level_close()</td> <td>получить &quot;Level close&quot; инструмента портфеля</td></tr> <tr><td>long long max_trans_musec()</td> <td>получить &quot;Max trans time&quot; инструмента портфеля</td></tr> <tr><td>long long ban_period()</td> <td>получить &quot;Ban period&quot; инструмента портфеля</td></tr> <tr><td>void set_count(long long v)</td> <td>изменить &quot;Count&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_depth_ob(int v)</td> <td>изменить &quot;Depth OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ob_c_p_t(int v)</td> <td>изменить &quot;Calc price OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ob_t_p_t(int v)</td> <td>изменить &quot;Trading price OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_decimals(int v)</td> <td>изменить &quot;Decimals&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_client_code(std::string v)</td> <td>изменить &quot;Client code&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_on_buy(int v)</td> <td>изменить &quot;On buy&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_leverage(int v)</td> <td>изменить &quot;Leverage&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_count_type(int v)</td> <td>изменить &quot;Count type&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_k(double v)</td> <td>изменить &quot;k&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_sle(bool v)</td> <td>изменить &quot;SLE&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_sl(double v)</td> <td>изменить &quot;SL&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_tp(double v)</td> <td>изменить &quot;TP&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_k_sl(double v)</td> <td>изменить &quot;k_sl&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_te(bool v)</td> <td>изменить &quot;TE&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_timer(int v)</td> <td>изменить &quot;Timer&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ratio_sign(int v)</td> <td>изменить &quot;Ratio sign&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ratio_type(int v)</td> <td>изменить &quot;Ratio type&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_percent_of_quantity(double v)</td> <td>изменить &quot;Percent of quantity&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_fin_res_mult(double v)</td> <td>изменить &quot;Fin res multiplier&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_comission_sign(int v)</td> <td>изменить &quot;Commission type&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_comission(double v)</td> <td>изменить &quot;Commission&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_mm(bool v)</td> <td>изменить &quot;MM&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_maker(bool v)</td> <td>изменить &quot;Only maker&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_move_limits(bool v)</td> <td>изменить &quot;FUT move limits&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_move_limits1(bool v)</td> <td>изменить &quot;SPOT move limits&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_depth_ob(int v)</td> <td>изменить &quot;Depth OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ob_c_p_t(int v)</td> <td>изменить &quot;Calc price OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ob_t_p_t(int v)</td> <td>изменить &quot;Trading price OB&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_mc_level_to0(double v)</td> <td>изменить &quot;Level to0&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_mc_level_close(double v)</td> <td>изменить &quot;Level close&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_max_trans_musec(long long v)</td> <td>изменить &quot;Max trans time&quot; инструмента портфеля на значение v</td></tr> <tr><td>void set_ban_period(long long v)</td> <td>изменить &quot;Ban period&quot; инструмента портфеля на значение v</td></tr></tbody></table> <p>Методы <code>order_pool</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>bool has_next()</td> <td>есть ли еще заявка в списке заявок</td></tr> <tr><td>order_item next()</td> <td>получить текущую заявку (если ее нет, вы получите исключение std::out_of_range) и передвинуть указатель на следующую заявку в списке</td></tr></tbody></table> <p>По своей сути <code>order_pool</code> является итератором для списка заявок бумаги портфеля робота. Вы можете получить только следующую заявку в списке, если нужно вернуться к предыдущей - сохраняйте ее или получите <code>order_pool</code> заново.</p> <p>Поля <code>order_item</code>:</p> <table><thead><tr><th>Название</th> <th>Тип</th> <th>Описание</th></tr></thead> <tbody><tr><td>price</td> <td>double</td> <td>цена</td></tr> <tr><td>amount</td> <td>long long</td> <td>количество</td></tr> <tr><td>amount_rest</td> <td>long long</td> <td>остаток</td></tr> <tr><td>dir</td> <td>int</td> <td>направление</td></tr> <tr><td>status</td> <td>int</td> <td>статус</td></tr></tbody></table> <p><code>order_item</code> является заявкой робота, возможные значения полей <code>dir</code> и <code>status</code> описаны в константах.</p> <p><a href="https://fkviking.github.io/bot-doc08-c-api.md#_8-8-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BA-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%B0%D0%BC-%D0%BF%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8F-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0-%D1%81%D0%B4%D0%B5%D0%BB%D0%BA%D0%B8-%D0%BF%D0%BE%D0%B7%D0%B8%D1%86%D0%B8%D0%B8" target="_blank" rel="noopener noreferrer"><em>Пример:</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> использования структур <code>order_pool</code> и <code>order_item</code></p> <h2 id="_8-5-доступ-и-изменение-полеи-портфеля" tabindex="-1"><a href="#_8-5-доступ-и-изменение-полеи-портфеля" class="header-anchor">#</a> 8.5. Доступ и изменение полей портфеля <div class="anchor-container" data-v-72af3cd3><span id="доступ-и-изменение-полей-портфеля" data-v-72af3cd3></span></div></h2> <table><thead><tr><th>Функция</th> <th>Описание</th></tr></thead> <tbody><tr><td>struct portfolio get_portfolio(const std::string&amp; p)</td> <td>получить портфель c именем p</td></tr> <tr><td>struct portfolio get_portfolio()</td> <td>получить текущий портфель</td></tr></tbody></table> <p>Методы <code>portfolio</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>void restart_sec_iter()</td> <td>инциализировать итератор (для одного портфеля НЕЛЬЗЯ использовать один итератор вложенный в другой)</td></tr> <tr><td>bool has_next_sec()</td> <td>есть ли еще бумаги в списке бумаг портфеля</td></tr> <tr><td>security_fields next_sec()</td> <td>получить следующую бумагу портфеля (<a href="#__Example3__"> пример итерации </a>)</td></tr> <tr><td>deal_item deal(const std::string&amp; s)</td> <td>получить сделку по бумаге c SecKey s (доступно только в Trade formula, т.е. на момент совершения сделки), если сделки по указанной бумаге в реальности не было, то <code>amount</code> и <code>price</code> будут равны нулю</td></tr> <tr><td>deal_item deal(const security_fields&amp; sf)</td> <td>получить сделку по бумаге sf (доступно только в Trade formula, т.е. на момент совершения сделки), если сделки по указанной бумаге в реальности не было, то <code>amount</code> и <code>price</code> будут равны нулю</td></tr> <tr><td>struct security_fields security_field(const std::string&amp; s)</td> <td>получить бумагу данного портфеля с SecKey s</td></tr> <tr><td>struct security_fields security_field()</td> <td>получить главную бумагу текущего портфеля</td></tr> <tr><td>std::map&lt;std::string, double&gt;&amp; data()</td> <td>словарь для сохранения пользовательских значений, НЕ будет сохранен при выключении робота</td></tr> <tr><td>const user_value&amp; uf0()</td> <td>получить &quot;пользовательское поле&quot; под номером 0 (пользовательские значения никак НЕ используются в штатном алгоритме робота)</td></tr> <tr><td>...</td> <td>...</td></tr> <tr><td>const user_value&amp; uf19()</td> <td>получить &quot;пользовательское поле&quot; под номером 19 (пользовательские значения никак НЕ используются в штатном алгоритме робота)</td></tr> <tr><td>std::string name()</td> <td>получить &quot;Name&quot; портфеля</td></tr> <tr><td>int decimals()</td> <td>получить &quot;Decimals&quot; портфеля</td></tr> <tr><td>std::string comment()</td> <td>получить &quot;Comment&quot; портфеля</td></tr> <tr><td>bool re_sell()</td> <td>получить &quot;re_sell&quot; портфеля</td></tr> <tr><td>bool re_buy()</td> <td>получить &quot;re_buy&quot; портфеля</td></tr> <tr><td>bool use_tt()</td> <td>получить &quot;Use timetable&quot; портфеля</td></tr> <tr><td>int portfolio_type()</td> <td>получить &quot;Type&quot; портфеля</td></tr> <tr><td>long long v_in_l()</td> <td>получить &quot;v_in_left&quot; портфеля</td></tr> <tr><td>long long v_in_r()</td> <td>получить &quot;v_in_right&quot; портфеля</td></tr> <tr><td>long long v_out_l()</td> <td>получить &quot;v_out_left&quot; портфеля</td></tr> <tr><td>long long v_out_r()</td> <td>получить &quot;v_out_right&quot; портфеля</td></tr> <tr><td>long long v_min()</td> <td>получить &quot;v_min&quot; портфеля</td></tr> <tr><td>long long v_max()</td> <td>получить &quot;v_max&quot; портфеля</td></tr> <tr><td>double k()</td> <td>получить &quot;K&quot; портфеля</td></tr> <tr><td>double k1()</td> <td>получить &quot;K1&quot; портфеля</td></tr> <tr><td>double k2()</td> <td>получить &quot;K2&quot; портфеля</td></tr> <tr><td>double tp()</td> <td>получить &quot;TP&quot; портфеля</td></tr> <tr><td>bool equal_prices()</td> <td>получить &quot;Equal prices&quot; портфеля</td></tr> <tr><td>bool always_limits_timer()</td> <td>получить &quot;Always timer&quot; портфеля</td></tr> <tr><td>double lim_s()</td> <td>получить &quot;Lim_Sell&quot; портфеля</td></tr> <tr><td>double lim_b()</td> <td>получить &quot;Lim_Buy&quot; портфеля</td></tr> <tr><td>double delta()</td> <td>получить &quot;Delta&quot; портфеля</td></tr> <tr><td>double first_delta()</td> <td>получить &quot;First delta&quot; портфеля</td></tr> <tr><td>long long mkt_volume()</td> <td>получить &quot;Market volume&quot; портфеля</td></tr> <tr><td>int type_trade()</td> <td>получить &quot;Type trade&quot; портфеля</td></tr> <tr><td>int price_type()</td> <td>получить &quot;Type price&quot; портфеля</td></tr> <tr><td>bool simply_first()</td> <td>получить &quot;Simply first&quot; портфеля</td></tr> <tr><td>bool quote()</td> <td>получить &quot;Quote&quot; портфеля</td></tr> <tr><td>double percent()</td> <td>получить &quot;Percent&quot; портфеля</td></tr> <tr><td>int timer()</td> <td>получить &quot;Limits timer&quot; портфеля</td></tr> <tr><td>bool to0()</td> <td>получить &quot;To0&quot; портфеля</td></tr> <tr><td>bool virtual_0_pos()</td> <td>получить &quot;Virt 0 pos&quot; портфеля</td></tr> <tr><td>double opened()</td> <td>получить &quot;Opened&quot; портфеля</td></tr> <tr><td>double opened_comission()</td> <td>получить &quot;Commission sum&quot; портфеля</td></tr> <tr><td>double fin_res_wo_c()</td> <td>получить &quot;Fin res wo C&quot; портфеля</td></tr> <tr><td>double fin_res()</td> <td>получить &quot;Fin res&quot; портфеля</td></tr> <tr><td>long long pos()</td> <td>получить &quot;Pos&quot; портфеля</td></tr> <tr><td>int n_perc_fill()</td> <td>получить &quot;n_perc_fill&quot; портфеля</td></tr> <tr><td>int max_not_hedged()</td> <td>получить &quot;Max not hedged&quot; портфеля</td></tr> <tr><td>double return_first()</td> <td>получить &quot;Return first&quot; портфеля</td></tr> <tr><td>double price_check()</td> <td>получить &quot;Price check&quot; портфеля</td></tr> <tr><td>int hedge_after()</td> <td>получить &quot;Hedge (sec)&quot; портфеля</td></tr> <tr><td>long long overlay()</td> <td>получить &quot;Overlay&quot; портфеля</td></tr> <tr><td>double ext_field1()</td> <td>получить &quot;Extra field#1&quot; портфеля</td></tr> <tr><td>double ext_field2()</td> <td>получить &quot;Extra field#2&quot; портфеля</td></tr> <tr><td>double sell()</td> <td>получить &quot;Sell&quot; портфеля</td></tr> <tr><td>double buy()</td> <td>получить &quot;Buy&quot; портфеля</td></tr> <tr><td>double price_s()</td> <td>получить &quot;Price_s&quot; портфеля</td></tr> <tr><td>double price_b()</td> <td>получить &quot;Price_b&quot; портфеля</td></tr> <tr><td>void set_uf0(const user_value&amp; v)</td> <td>изменить &quot;пользовательское поле&quot; под номером 0 (пользовательские значения никак НЕ используются в штатном алгоритме робота)</td></tr> <tr><td>...</td> <td>...</td></tr> <tr><td>void set_uf19(const user_value&amp; v)</td> <td>изменить &quot;пользовательское поле&quot; под номером 19 (пользовательские значения никак НЕ используются в штатном алгоритме робота)</td></tr> <tr><td>void set_decimals(int v)</td> <td>изменить &quot;Decimals&quot; портфеля на значение v</td></tr> <tr><td>void set_comment(std::string v)</td> <td>изменить &quot;Comment&quot; портфеля на значение v</td></tr> <tr><td>void set_re_sell(bool v)</td> <td>изменить &quot;re_sell&quot; портфеля на значение v</td></tr> <tr><td>void set_re_buy(bool v)</td> <td>изменить &quot;re_buy&quot; портфеля на значение v</td></tr> <tr><td>void set_use_tt(bool v)</td> <td>изменить &quot;Use timetable&quot; портфеля на значение v</td></tr> <tr><td>void set_portfolio_type(int v)</td> <td>изменить &quot;Type&quot; портфеля на значение v</td></tr> <tr><td>void set_v_in_l(long long v)</td> <td>изменить &quot;v_in_left&quot; портфеля на значение v</td></tr> <tr><td>void set_v_in_r(long long v)</td> <td>изменить &quot;v_in_right&quot; портфеля на значение v</td></tr> <tr><td>void set_v_out_l(long long v)</td> <td>изменить &quot;v_out_left&quot; портфеля на значение v</td></tr> <tr><td>void set_v_out_r(long long v)</td> <td>изменить &quot;v_out_right&quot; портфеля на значение v</td></tr> <tr><td>void set_v_min(long long v)</td> <td>изменить &quot;v_min&quot; портфеля на значение v</td></tr> <tr><td>void set_v_max(long long v)</td> <td>изменить &quot;v_max&quot; портфеля на значение v</td></tr> <tr><td>void set_k(double v)</td> <td>изменить &quot;K&quot; портфеля на значение v</td></tr> <tr><td>void set_k1(double v)</td> <td>изменить &quot;K1&quot; портфеля на значение v</td></tr> <tr><td>void set_k2(double v)</td> <td>изменить &quot;K2&quot; портфеля на значение v</td></tr> <tr><td>void set_tp(double v)</td> <td>изменить &quot;TP&quot; портфеля на значение v</td></tr> <tr><td>void set_equal_prices(bool v)</td> <td>изменить &quot;Equal prices&quot; портфеля на значение v</td></tr> <tr><td>void set_always_limits_timer(bool v)</td> <td>изменить &quot;Always timer&quot; портфеля на значение v</td></tr> <tr><td>void set_lim_s(double v)</td> <td>изменить &quot;Lim_Sell&quot; портфеля на значение v</td></tr> <tr><td>void set_lim_b(double v)</td> <td>изменить &quot;Lim_Buy&quot; портфеля на значение v</td></tr> <tr><td>void set_delta(double v)</td> <td>изменить &quot;Delta&quot; портфеля на значение v</td></tr> <tr><td>void set_first_delta(double v)</td> <td>изменить &quot;First delta&quot; портфеля на значение v</td></tr> <tr><td>void set_mkt_volume(long long v)</td> <td>изменить &quot;Market volume&quot; портфеля на значение v</td></tr> <tr><td>void set_type_trade(int v)</td> <td>изменить &quot;Type trade&quot; портфеля на значение v</td></tr> <tr><td>void set_price_type(int v)</td> <td>изменить &quot;Type price&quot; портфеля на значение v</td></tr> <tr><td>void set_simply_first(bool v)</td> <td>изменить &quot;Simply first&quot; портфеля на значение v</td></tr> <tr><td>void set_quote(bool v)</td> <td>изменить &quot;Quote&quot; портфеля на значение v</td></tr> <tr><td>void set_percent(double v)</td> <td>изменить &quot;Percent&quot; портфеля на значение v</td></tr> <tr><td>void set_timer(int v)</td> <td>изменить &quot;Limits timer&quot; портфеля на значение v</td></tr> <tr><td>void set_to0(bool v)</td> <td>изменить &quot;To0&quot; портфеля на значение v</td></tr> <tr><td>void set_virtual_0_pos(bool v)</td> <td>изменить &quot;Virt 0 pos&quot; портфеля на значение v</td></tr> <tr><td>void set_opened(double v)</td> <td>изменить &quot;Opened&quot; портфеля на значение v</td></tr> <tr><td>void set_opened_comission(double v)</td> <td>изменить &quot;Commission sum&quot; портфеля на значение v</td></tr> <tr><td>void set_n_perc_fill(int v)</td> <td>изменить &quot;n_perc_fill&quot; портфеля на значение v</td></tr> <tr><td>void set_max_not_hedged(int v)</td> <td>изменить &quot;Max not hedged&quot; портфеля на значение v</td></tr> <tr><td>void set_return_first(double v)</td> <td>изменить &quot;Return first&quot; портфеля на значение v</td></tr> <tr><td>void set_price_check(double v)</td> <td>изменить &quot;Price check&quot; портфеля на значение v</td></tr> <tr><td>void set_hedge_after(int v)</td> <td>изменить &quot;Hedge (sec)&quot; портфеля на значение v</td></tr> <tr><td>void set_overlay(long long v)</td> <td>изменить &quot;Overlay&quot; портфеля на значение v</td></tr></tbody></table> <p>Для того чтобы иметь возможность обращаться по индексу к &quot;пользовательским полям&quot; есть массивы:<div class="anchor-container" data-v-72af3cd3><span id="user-fields" data-v-72af3cd3></span></div></p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">const</span> user_value<span class="token operator">&amp;</span> <span class="token punctuation">(</span>portfolio<span class="token operator">::</span><span class="token operator">*</span>gUF<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> gUF uf<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf4<span class="token punctuation">,</span>
                         <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf5<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf6<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf9<span class="token punctuation">,</span>
                         <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf10<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf11<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf12<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf13<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf14<span class="token punctuation">,</span>
                         <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf15<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf16<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf17<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf18<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>uf19<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span>portfolio<span class="token operator">::</span><span class="token operator">*</span>sUF<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> user_value<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> sUF set_uf<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf4<span class="token punctuation">,</span>
                             <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf5<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf6<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf7<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf9<span class="token punctuation">,</span>
                             <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf10<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf11<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf12<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf13<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf14<span class="token punctuation">,</span>
                             <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf15<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf16<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf17<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf18<span class="token punctuation">,</span> <span class="token operator">&amp;</span>portfolio<span class="token operator">::</span>set_uf19<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="#__Example6__"><em>Пример:</em></a> Пример доступа и редактирования &quot;пользовательских полей&quot; по индексу.</p> <p>Поля <code>deal_item</code>:</p> <table><thead><tr><th>Название</th> <th>Тип</th> <th>Описание</th></tr></thead> <tbody><tr><td>price</td> <td>double</td> <td>средневзвешенная цена сделки</td></tr> <tr><td>amount</td> <td>long long</td> <td>суммарный объем сделки в лотах</td></tr> <tr><td>dir</td> <td>int</td> <td>направление сделки: 1 - покупка, 2 - продажа</td></tr></tbody></table> <p>Конструкторы <code>user_value</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>user_value()</td> <td>создать &quot;пустое&quot; пользовательское значение</td></tr> <tr><td>user_value(double value, const std::string&amp; caption)</td> <td>создать пользовательское значение, указав значение и подпись</td></tr> <tr><td>user_value(double value)</td> <td>создать пользовательское значение, указав только зачение</td></tr> <tr><td>user_value(const std::string&amp; caption)</td> <td>создать пользовательское значение, указав только подпись</td></tr></tbody></table> <p>Методы <code>user_value</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>double value() const</td> <td>получить значение</td></tr> <tr><td>void set_value(double value)</td> <td>задать значение</td></tr> <tr><td>bool has_value() const</td> <td>проверить задано ли значение</td></tr> <tr><td>std::string caption() const</td> <td>получить подпись</td></tr> <tr><td>void set_caption(const std::string&amp; caption)</td> <td>задать подпись</td></tr> <tr><td>bool has_caption() const</td> <td>проверить задана ли подпись</td></tr> <tr><td>user_value&amp; operator=(const user_value&amp; v)</td> <td>оператор копирования, только НЕ &quot;пустые&quot; значения будут скопированы</td></tr></tbody></table> <p><a href="#__Example2__"><em>Пример:</em></a> Пример использования структуры <code>user_value</code>.</p> <h2 id="_8-6-доступ-и-изменение-позиции-транзакционного-подключения" tabindex="-1"><a href="#_8-6-доступ-и-изменение-позиции-транзакционного-подключения" class="header-anchor">#</a> 8.6. Доступ и изменение позиций транзакционного подключения <div class="anchor-container" data-v-72af3cd3><span id="доступ-и-изменение-позиций-транзакционного-подключения" data-v-72af3cd3></span></div></h2> <table><thead><tr><th>Функция</th> <th>Описание</th></tr></thead> <tbody><tr><td>struct connection get_connection(const std::string&amp; c)</td> <td>получить подключение c именем c</td></tr></tbody></table> <p>Методы <code>connection</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>sec_item sec(const std::string&amp; s)</td> <td>получить информацию о позиции инструмена на бирже (в качестве s необходимо использовать SecBoard из пп <strong>5.5.1. Параметры позиций по инструментам</strong>)</td></tr> <tr><td>coin_item sec(const std::string&amp; s)</td> <td>получить информацию о балансе валюты на бирже (в качестве s необходимо использовать Currency из <strong>5.5.2. Параметры позиций по валютам</strong>)</td></tr> <tr><td>bool is_active()</td> <td>получить информацию о том подключено ли подключение к бирже</td></tr></tbody></table> <p>Meтоды <code>sec_item</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>long long pos()</td> <td>получить поле &quot;Pos&quot; инструмента</td></tr> <tr><td>long long robot_pos()</td> <td>получить поле &quot;Robot pos&quot; инструмента</td></tr> <tr><td>double mark_price()</td> <td>получить поле &quot;Mark. price&quot; инструмента</td></tr> <tr><td>double liq_price()</td> <td>получить поле &quot;Liq. price&quot; инструмента</td></tr> <tr><td>long long pos_lag()</td> <td>получить поле &quot;Pos lag&quot; инструмента</td></tr> <tr><td>bool pos_eq()</td> <td>получить поле &quot;Check equality&quot; инструмента</td></tr> <tr><td>bool tgr()</td> <td>получить поле &quot;Tgr notify&quot; инструмента</td></tr> <tr><td>void set_pos_lag(long long v)</td> <td>изменить поле &quot;Pos lag&quot; инструмента</td></tr> <tr><td>void set_pos_eq(bool v)</td> <td>изменить поле &quot;Check equality&quot; инструмента</td></tr> <tr><td>void set_tgr(bool v)</td> <td>изменить поле &quot;Tgr notify&quot; инструмента</td></tr></tbody></table> <p>Meтоды <code>coin_item</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>double pos()</td> <td>получить поле &quot;Pos&quot; (или &quot;Limit&quot;) валюты</td></tr> <tr><td>double robot_pos()</td> <td>получить поле &quot;Robot pos&quot; валюты</td></tr> <tr><td>double pos_lag()</td> <td>получить поле &quot;Pos lag&quot; валюты</td></tr> <tr><td>bool pos_eq()</td> <td>получить поле &quot;Check equality&quot; валюты</td></tr> <tr><td>bool tgr()</td> <td>получить поле &quot;Tgr notify&quot; валюты</td></tr> <tr><td>void set_pos_lag(double v)</td> <td>изменить поле &quot;Pos lag&quot; валюты</td></tr> <tr><td>void set_pos_eq(bool v)</td> <td>изменить поле &quot;Check equality&quot; валюты</td></tr> <tr><td>void set_tgr(bool v)</td> <td>изменить поле &quot;Tgr notify&quot; валюты</td></tr></tbody></table> <h2 id="_8-7-дополнительные-классы-структуры-функции-и-константы" tabindex="-1"><a href="#_8-7-дополнительные-классы-структуры-функции-и-константы" class="header-anchor">#</a> 8.7. Дополнительные классы, структуры, функции и константы <div class="anchor-container" data-v-72af3cd3><span id="дополнительные-классы,-структуры,-функции-и-константы" data-v-72af3cd3></span></div></h2> <h3 id="_8-7-1-константы" tabindex="-1"><a href="#_8-7-1-константы" class="header-anchor">#</a> 8.7.1. Константы <div class="anchor-container" data-v-72af3cd3><span id="константы" data-v-72af3cd3></span></div></h3> <table><thead><tr><th>Название</th> <th>Тип</th> <th>Значение/описание</th></tr></thead> <tbody><tr><td>BUY</td> <td>int</td> <td>1, направление торговли - покупка</td></tr> <tr><td>SELL</td> <td>int</td> <td>2, направление торговли - продажа</td></tr> <tr><td>FREE</td> <td>int</td> <td>0, заявка не активна</td></tr> <tr><td>ADDING</td> <td>int</td> <td>1, заявка отправлена на биржу</td></tr> <tr><td>RUNNING</td> <td>int</td> <td>2, получен ответ о том, что заявка выставлена</td></tr> <tr><td>DELETING</td> <td>int</td> <td>4, снятие заявки отправлено на биржу</td></tr> <tr><td>FIRST_DELETING</td> <td>int</td> <td>5, снятие котируемой заявки отправлено на биржу</td></tr> <tr><td>SL_DELETING</td> <td>int</td> <td>6, снятие заявки по стопу отправлено на биржу</td></tr> <tr><td>MOVING</td> <td>int</td> <td>7, запрос на изменение заявки отправлен на биржу</td></tr> <tr><td>ADD_ERROR</td> <td>int</td> <td>99, ошибка выставления заявки</td></tr> <tr><td>TRADING_HALT</td> <td>int</td> <td>0, выставления и снятие заявок запрещены</td></tr> <tr><td><div class="anchor-container" data-v-72af3cd3><span id="__TRADING_CAN_PLACE__" data-v-72af3cd3></span></div>TRADING_CAN_PLACE</td> <td>int</td> <td>1, разрешено выставления заявок</td></tr> <tr><td><div class="anchor-container" data-v-72af3cd3><span id="__TRADING_CAN_CANCEL__" data-v-72af3cd3></span></div>TRADING_CAN_CANCEL</td> <td>int</td> <td>2, разрешено снятие заявок</td></tr> <tr><td>MARKET_DATA_OFFLINE</td> <td>int</td> <td>0, маркет-дата подключение для данной бумаги оффлайн</td></tr> <tr><td><div class="anchor-container" data-v-72af3cd3><span id="__MARKET_DATA_BESTS_ONLINE__" data-v-72af3cd3></span></div>MARKET_DATA_BESTS_ONLINE</td> <td>int</td> <td>1, для данной бумаги маркет-дата подключение с лучшими ценами на покупку/продажу онлайн</td></tr> <tr><td><div class="anchor-container" data-v-72af3cd3><span id="__MARKET_DATA_OB_ONLINE__" data-v-72af3cd3></span></div>MARKET_DATA_OB_ONLINE</td> <td>int</td> <td>2, для данной бумаги маркет-дата подключение со стаканами онлайн</td></tr> <tr><td>NAME</td> <td>std::string</td> <td>имя текущего портфеля</td></tr></tbody></table> <h3 id="_8-7-2-функции" tabindex="-1"><a href="#_8-7-2-функции" class="header-anchor">#</a> 8.7.2. Функции <div class="anchor-container" data-v-72af3cd3><span id="функции" data-v-72af3cd3></span></div></h3> <table><thead><tr><th>Функция</th> <th>Описание</th></tr></thead> <tbody><tr><td>long long nanosec_date_time()</td> <td>получить текущее время в epoch в наносекундах</td></tr> <tr><td>struct tm global_tm()</td> <td>получить текущее время</td></tr> <tr><td>day_time get_day_time()</td> <td>получить текущее время дня</td></tr> <tr><td>void log_info(const std::string&amp; msg)</td> <td>отправить сообщение с уровнем INFO в лог</td></tr> <tr><td>void log_warn(const std::string&amp; msg)</td> <td>отправить сообщение с уровнем WARNING в лог</td></tr> <tr><td>void log_error(const std::string&amp; msg)</td> <td>отправить сообщение с уровнем ERROR в лог</td></tr> <tr><td><div class="anchor-container" data-v-72af3cd3><span id="__TGR_NOTIFY__" data-v-72af3cd3></span></div> bool tgr_notify(int slot, const std::string&amp; msg, int timeout)</td> <td>отправить сообщение с уровнем NOTIFICATION в лог и уведомление в telegram, отправлять не чаще, чем <code>timeout</code> секунд (число из отрезка <code>[10, 2000000000]</code>), <code>slot</code> - идентификатор слота уведомления (число из отрезка <code>[0, 4]</code>), для которого будет отсчитываться <code>timeout</code></td></tr></tbody></table> <h3 id="_8-7-3-структуры" tabindex="-1"><a href="#_8-7-3-структуры" class="header-anchor">#</a> 8.7.3. Структуры <div class="anchor-container" data-v-72af3cd3><span id="структуры" data-v-72af3cd3></span></div></h3> <p>Структура <code>day_time</code> (время дня в часах, минутах, секундах):<div class="anchor-container" data-v-72af3cd3><span id="day_time" data-v-72af3cd3></span></div></p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>day_time()</td> <td>создать объект с временем <code>00:00:00</code></td></tr> <tr><td>day_time(int h, int m, int s)</td> <td>создать объект с временем <code>h:m:s</code></td></tr> <tr><td>day_time(const day_time&amp; dt)</td> <td>конструктор копирования</td></tr></tbody></table> <table><thead><tr><th>Название поля</th> <th>Тип</th> <th>Описание</th></tr></thead> <tbody><tr><td>h</td> <td>int</td> <td>часы (от <code>0</code> до <code>23</code>)</td></tr> <tr><td>m</td> <td>int</td> <td>минуты (от <code>0</code> до <code>59</code>)</td></tr> <tr><td>s</td> <td>int</td> <td>секунды (от <code>0</code> до <code>59</code>)</td></tr></tbody></table> <table><thead><tr><th>Функции и методы</th> <th>Описание</th></tr></thead> <tbody><tr><td>int to_sec() const</td> <td>получить время в секундах, т.е. <code>h * 3600 + m * 60 + s</code></td></tr> <tr><td>bool operator&lt;(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>&lt;</code></td></tr> <tr><td>bool operator&lt;=(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>&lt;=</code></td></tr> <tr><td>bool operator&gt;(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>&gt;</code></td></tr> <tr><td>bool operator&gt;=(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>&gt;=</code></td></tr> <tr><td>bool operator==(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>==</code></td></tr> <tr><td>bool operator!=(const day_time&amp; a, const day_time&amp; b)</td> <td>оператор <code>!=</code></td></tr></tbody></table> <p><a href="#__Example4__"><em>Пример:</em></a> Пример использования структуры <code>day_time</code>.</p> <h3 id="_8-7-4-классы" tabindex="-1"><a href="#_8-7-4-классы" class="header-anchor">#</a> 8.7.4. Классы <div class="anchor-container" data-v-72af3cd3><span id="классы" data-v-72af3cd3></span></div></h3> <p><strong>Важно:</strong> все классы, описанные ниже, относятся к пространству имен <code>timers</code>.</p> <p>Класс <code>timer</code> (отмеряет отрезки времени не менее заданного в наносекундах): <div class="anchor-container" data-v-72af3cd3><span id="timers" data-v-72af3cd3></span></div></p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>timer(unsigned long long timeout, bool initialized = false)</td> <td>создать объект с интервалом таймера <code>timeout</code> (в наносекундах), если <code>initialized</code> истинно, то стартовое время будет задано текущим временем, иначе стартовое время не определено и первый <code>timeout</code> сработает сразу</td></tr></tbody></table> <table><thead><tr><th>Функции и методы</th> <th>Описание</th></tr></thead> <tbody><tr><td>bool tick()</td> <td>Если с момента предыдущего вызова данного метода прошло не меньше, чем <code>timeout</code> наносекунд, то вернет истину и обновит предыдущее время вызова</td></tr></tbody></table> <p>Класс <code>day_timer</code> (отмеряет сутки и вызывается не ранее, чем в заданный момент времени):</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>day_timer(int h, int m, int s, bool initialized = false)</td> <td>создать объект с временем срабатывания на следующие сутки не раньше, чем в момент времени <code>h:m:s</code> (часов, минут, секунд), если <code>initialized</code> истинно, то стартовое время будет задано текущим временем, иначе стартовое время не определено и первый таймаут может сработать и без смены дня</td></tr> <tr><td>day_timer(int h, int m, bool initialized = false)</td> <td>создать объект с временем срабатывания на следующие сутки не раньше, чем в момент времени <code>h:m</code> (часов, минут, <code>0</code> секунд), если <code>initialized</code> истинно, то стартовое время будет задано текущим временем, иначе стартовое время не определено и первый таймаут может сработать и без смены дня</td></tr> <tr><td>day_timer(const <a href="#day_time">day_time</a>&amp; dt, bool initialized = false)</td> <td>создать объект с временем срабатывания на следующие сутки не раньше, чем в момент времени <code>dt</code>, если <code>initialized</code> истинно, то стартовое время будет задано текущим временем, иначе стартовое время не определено и первый таймаут может сработать и без смены дня</td></tr></tbody></table> <table><thead><tr><th>Функции и методы</th> <th>Описание</th></tr></thead> <tbody><tr><td>bool tick()</td> <td>Если изменился день и текущее время больше или равно заданному, то вернет истину и обновит сохраненный день</td></tr></tbody></table> <p><a href="#__Example7__"><em>Пример:</em></a> Примеры использования классов <code>timer</code> и <code>day_timer</code>.</p> <h3 id="_8-7-5-функции-для-работы-с-опционами" tabindex="-1"><a href="#_8-7-5-функции-для-работы-с-опционами" class="header-anchor">#</a> 8.7.5. Функции для работы с опционами <div class="anchor-container" data-v-72af3cd3><span id="функции-для-работы-с-опционами" data-v-72af3cd3></span></div></h3> <h4 id="_8-7-5-1-умные-функции" tabindex="-1"><a href="#_8-7-5-1-умные-функции" class="header-anchor">#</a> 8.7.5.1. <em>“Умные” функции</em> <div class="anchor-container" data-v-72af3cd3><span id="_“умные”-функции_" data-v-72af3cd3></span></div></h4> <p><strong>double S_delta(const std::string&amp; s, double rate = 0)</strong><br> <strong>double P_delta(const std::string&amp; p, double rate = 0)</strong><br>
вычисляет дельту финансового инструмента или портфеля со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p><strong>double S_gamma(const std::string&amp; s, double rate = 0)</strong><br> <strong>double P_gamma(const std::string&amp; p, double rate = 0)</strong><br>
вычисляет гамму финансового инструмента или портфеля со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p><strong>double S_vega(const std::string&amp; s, double rate = 0)</strong><br> <strong>double P_vega(const std::string&amp; p, double rate = 0)</strong><br>
вычисляет вегу финансового инструмента или портфеля со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p><strong>double S_theta(const std::string&amp; s, double rate = 0)</strong><br> <strong>double P_theta(const std::string&amp; p, double rate = 0)</strong><br>
вычисляет тету финансового инструмента или портфеля со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p><strong>double S_iv(const std::string&amp; s, double rate = 0)</strong><br> <strong>double P_iv(const std::string&amp; p, double rate = 0)</strong><br>
вычисляет ожидаемую волатильность опциона или портфеля со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p><strong>double S_price(const std::string&amp; s, double rate = 0)</strong><br>
вычисляет справедливую цену опциона со ставкой рефинансирования <code>rate</code> (указывается в процентах)</p> <p>Аргументы для функций выше:</p> <table><thead><tr><th>Название</th> <th>Описание</th></tr></thead> <tbody><tr><td>s</td> <td>ключ инструмента SecKey</td></tr> <tr><td>p</td> <td>имя портфеля</td></tr> <tr><td>rate</td> <td>ставка рефинансирования в процентах</td></tr></tbody></table> <h4 id="_8-7-5-2-простые-функции" tabindex="-1"><a href="#_8-7-5-2-простые-функции" class="header-anchor">#</a> 8.7.5.2. <em>“Простые” функции</em> <div class="anchor-container" data-v-72af3cd3><span id="_“простые”-функции_" data-v-72af3cd3></span></div></h4> <p><strong>double C(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет справедливую цену опциона <code>call</code></p> <p><strong>double P(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет справедливую цену опциона <code>put</code></p> <p><strong>double CDELTA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет дельту опциона <code>call</code></p> <p><strong>double PDELTA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong>
вычисляет дельту опциона <code>put</code></p> <p><strong>double CGAMMA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет гамму опциона <code>call</code></p> <p><strong>double PGAMMA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет гамму опциона <code>put</code></p> <p><strong>double CVEGA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет вегу опциона <code>call</code></p> <p><strong>double PVEGA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет вегу опциона <code>put</code></p> <p><strong>double CTHETA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет тету опциона <code>call</code></p> <p><strong>double PTHETA(double futPrice, double strike, double expDate, double iv, double rate=0)</strong><br>
вычисляет тету опциона <code>put</code></p> <p><strong>double CIV(double futPrice, double strike, double expDate, double call, double rate=0)</strong><br>
вычисляет implied volatility опциона <code>call</code></p> <p><strong>double PIV(double futPrice, double strike, double expDate, double put, double rate=0)</strong><br>
вычисляет implied volatility опциона <code>put</code></p> <p>Аргументы для функций выше:</p> <table><thead><tr><th>Название</th> <th>Описание</th></tr></thead> <tbody><tr><td>futPrice</td> <td>цена базового актива</td></tr> <tr><td>strike</td> <td>цена страйк опциона</td></tr> <tr><td>expData</td> <td>дата экспирации опциона в формате epoch</td></tr> <tr><td>iv</td> <td>ожидаемая волатильность</td></tr> <tr><td>call/put</td> <td>цена опциона</td></tr> <tr><td>rate</td> <td>ставка рефинансирования в процентах</td></tr></tbody></table> <h2 id="_8-8-индикаторы-и-математическая-статистика" tabindex="-1"><a href="#_8-8-индикаторы-и-математическая-статистика" class="header-anchor">#</a> 8.8. Индикаторы и математическая статистика <div class="anchor-container" data-v-72af3cd3><span id="indicators-docs" data-v-72af3cd3></span><span id="индикаторы-и-математическая-статистика" data-v-72af3cd3></span></div></h2> <h3 id="_8-8-1-общие-положения" tabindex="-1"><a href="#_8-8-1-общие-положения" class="header-anchor">#</a> 8.8.1. Общие положения <div class="anchor-container" data-v-72af3cd3><span id="общие-положения" data-v-72af3cd3></span></div></h3> <h4 id="_8-8-1-1-особенности-объектов-для-расчета-значении-индикаторов" tabindex="-1"><a href="#_8-8-1-1-особенности-объектов-для-расчета-значении-индикаторов" class="header-anchor">#</a> 8.8.1.1. Особенности объектов для расчета значений индикаторов <div class="anchor-container" data-v-72af3cd3><span id="особенности-объектов-для-расчета-значений-индикаторов" data-v-72af3cd3></span></div></h4> <p>Для расчета индикаторов используются объекты соответствующих классов, т.к. объекты создаются внутри функции, то чтобы они каждый раз не создавались заново и инициализировались только один раз, все объекты предполагается создавать как статические (<code>static</code>). Если для расчета значения индикатора нужна
история, а ее в данный момент не хватает (т.е. количество значений в истории меньше, чем <code>length</code>), то в качестве значения <code>length</code> индикаторов будет использоваться текущее количество элементов в накопленной истории.</p> <p>Все &quot;формулы&quot; в роботе вызываются (пересчитываются) при любом обновлении стакана любой бумаги портфеля + раз в секунду, поэтому пытаться добавлять значение для пересчета индикатора вы можете довольно часто. Добавленное значение будет считаться новым и индикатор будет пересчитан, только если
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mfrac><mrow><mi>t</mi></mrow><mrow><mrow><mi mathvariant="italic">t</mi><mi mathvariant="italic">i</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">f</mi><mi mathvariant="italic">r</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi></mrow></mrow></mfrac><mo>]</mo><mo>×</mo><mrow><mi mathvariant="italic">t</mi><mi mathvariant="italic">i</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">f</mi><mi mathvariant="italic">r</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi></mrow><mo>&gt;</mo><msub><mi>t</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">[\frac{t}{\mathit{timeframe}}] \times \mathit{timeframe} &gt; t_{last}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.824556em;"></span><span class="strut bottom" style="height:1.305664em;vertical-align:-0.481108em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mclose">]</span><span class="mbin">×</span><span class="mord textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span><span class="mrel">&gt;</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">s</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span> - текущее время, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="italic">t</mi><mi mathvariant="italic">i</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">f</mi><mi mathvariant="italic">r</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">m</mi><mi mathvariant="italic">e</mi></mrow></mrow><annotation encoding="application/x-tex">\mathit{timeframe}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span></span></span></span> - таймфрейм для расчета индиактора, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{last}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">s</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - время последнего значения, используемого для расчета индикатора в данный момент. Т.е. по большому счету индикатор строится по
&quot;ценам открытия&quot; значений на выбранном таймфрейме.</p> <p><strong>Важно:</strong> все классы, описанные ниже, относятся к пространству имен <code>indicators</code>.</p> <p><a href="#__Example5__"><em>Примеры использования индикаторов в пользовательском коде.</em></a></p> <h4 id="_8-8-1-2-tradingdays-и-schedule-индикатора" tabindex="-1"><a href="#_8-8-1-2-tradingdays-и-schedule-индикатора" class="header-anchor">#</a> 8.8.1.2. <code>TradingDays</code> и <code>schedule</code> индикатора <div class="anchor-container" data-v-72af3cd3><span id="`tradingdays`-и-`schedule`-индикатора" data-v-72af3cd3></span></div></h4> <p>Для расчета любого индикатора обычно используются цены, получаемые с биржи. Если бумага на бирже торгуется 24/7, то никаких сложностей с ценами не возникает, в противном же случае встает вопрос фильтрации получаемых данных, чтобы не пересчитывать индикаторы на &quot;нулевых&quot; и &quot;кривых&quot; ценах (при
пустых стаканах в неторговые дни и часы, аукционах открытия и т.п.). Для фильтрации цен у объектов индикаторов существуют <code>TradingDays</code> и <code>schedule</code>, <code>TradingDays</code> - это фильтр по дням, а <code>schedule</code> - фильтр по временным интервалам внутри дня (для всех дней <code>schedule</code> одинаковое).</p> <p>По умолчанию <code>TradingDays</code> индикатора - это ссылка на <code>TradingDays</code> портфеля, в коде которого данный индикатор считается, т.е. при изменении <code>TradingDays</code> портфеля <code>TradingDays</code> индикатора тоже будет изменен (это справедливо даже если в портфеле <code>TradingDays</code> не используется). Если же необходимо
использовать свой <code>TradingDays</code>, то индикатору можно явно указать значение для <code>TradingDays</code>. <code>TradingDays</code> - это битовая маска торговых дней недели, дни недели занумерованы с нуля, причем нулевой бит (считая справа налево) - это воскресенье, т.е. воскресенье это <code>1 &lt;&lt; 0</code> (где <code>&lt;&lt;</code> это побитовый сдвиг
числа влево), понедельник это <code>1 &lt;&lt; 1</code> и т.д.</p> <p>По умолчанию <code>schedule</code> индикатора пуст, это означает, что расписание не задано и фильтрация по времени отсутствует. Если же <code>schedule</code> не пусто, то это список неперсекающихся временных интервалов (временной интервал - это пара времен, т.е. время начала и время конца, оба времени включительно)
в которые необходимо рассчитывать значение индекса.</p> <h4 id="_8-8-1-3-объект-indicators-interval" tabindex="-1"><a href="#_8-8-1-3-объект-indicators-interval" class="header-anchor">#</a> 8.8.1.3. Объект <code>indicators::interval</code> <div class="anchor-container" data-v-72af3cd3><span id="объект-`indicators::interval`" data-v-72af3cd3></span></div></h4> <p>Конструкторы <code>interval</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>interval(day_time b, day_time e)</td> <td>создать временной интервал c началом во время <code>b</code> и концом во время <code>e</code>, должно выполняться условие <code>b &lt; e</code>, иначае будет выброшено исключение <code>std::invalid_argument</code></td></tr></tbody></table> <h4 id="_8-8-1-4-объект-indicators-schedule" tabindex="-1"><a href="#_8-8-1-4-объект-indicators-schedule" class="header-anchor">#</a> 8.8.1.4. Объект <code>indicators::schedule</code> <div class="anchor-container" data-v-72af3cd3><span id="объект-`indicators::schedule`" data-v-72af3cd3></span></div></h4> <p>Конструкторы <code>schedule</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>schedule()</td> <td>создать пустое расписание</td></tr> <tr><td>schedule(std::vector&lt;interval&gt; sch)</td> <td>создать расписание, инициализированное списком непересекающихся интервалов, отсортированных по возрастанию, если интервалы пересекаются или не отсорированы по возрастанию, будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>schedule(const schedule&amp; sch)</td> <td>конструктор копирования</td></tr></tbody></table> <p>Методы <code>schedule</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>bool is_in(const day_time&amp; dt) const</td> <td>проверить находится ли указанное время в одном из интервалов расписания</td></tr></tbody></table> <h4 id="_8-8-1-5-константы" tabindex="-1"><a href="#_8-8-1-5-константы" class="header-anchor">#</a> 8.8.1.5. Константы <div class="anchor-container" data-v-72af3cd3><span id="константы" data-v-72af3cd3></span></div></h4> <table><thead><tr><th>Название</th> <th>Тип</th> <th>Значение/описание</th></tr></thead> <tbody><tr><td>WD_SUNDAY</td> <td>int</td> <td><code>1 &lt;&lt; 0</code>, воскресенье</td></tr> <tr><td>WD_MONDAY</td> <td>int</td> <td><code>1 &lt;&lt; 1</code>, понедельник</td></tr> <tr><td>WD_TUESDAY</td> <td>int</td> <td><code>1 &lt;&lt; 2</code>, вторник</td></tr> <tr><td>WD_WEDNESDAY</td> <td>int</td> <td><code>1 &lt;&lt; 3</code>, среда</td></tr> <tr><td>WD_THURSDAY</td> <td>int</td> <td><code>1 &lt;&lt; 4</code>, четверг</td></tr> <tr><td>WD_FRIDAY</td> <td>int</td> <td><code>1 &lt;&lt; 5</code>, пятница</td></tr> <tr><td>WD_SATURDAY</td> <td>int</td> <td><code>1 &lt;&lt; 6</code>, суббота</td></tr> <tr><td>WHOLE_WEEK</td> <td>int</td> <td><code>WD_SUNDAY | WD_MONDAY | WD_TUESDAY | WD_WEDNESDAY | WD_THURSDAY | WD_FRIDAY | WD_SATURDAY</code>, торговать всю неделю</td></tr> <tr><td>WORK_WEEK</td> <td>int</td> <td><code>WD_MONDAY | WD_TUESDAY | WD_WEDNESDAY | WD_THURSDAY | WD_FRIDAY</code>, торговать с понедельника по пятницу</td></tr></tbody></table> <h3 id="_8-8-2-простое-скользящее-среднее-sma" tabindex="-1"><a href="#_8-8-2-простое-скользящее-среднее-sma" class="header-anchor">#</a> 8.8.2. Простое скользящее среднее (<code>SMA</code>) <div class="anchor-container" data-v-72af3cd3><span id="простое-скользящее-среднее-(`sma`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{SMA}_t = \frac{1}{n} \sum_{i=0}^{n - 1}p_{t-i}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.8011130000000004em;"></span><span class="strut bottom" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{SMA}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t-i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">t-i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>SMA</code>).</p> <p>Конструкторы <code>SMA</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>SMA()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>SMA(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>SMA(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>SMA</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-3-экспоненциальное-скользящее-среднее-ema" tabindex="-1"><a href="#_8-8-3-экспоненциальное-скользящее-среднее-ema" class="header-anchor">#</a> 8.8.3. Экспоненциальное скользящее среднее (<code>EMA</code>) <div class="anchor-container" data-v-72af3cd3><span id="экспоненциальное-скользящее-среднее-(`ema`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>2</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>(</mo><msub><mi>p</mi><mi>t</mi></msub><mo>−</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>+</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{EMA}_t = \frac{2}{n + 1} (p_t - \mathit{EMA}_{t-1}) + \mathit{EMA}_{t-1}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.32144em;"></span><span class="strut bottom" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">2</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{EMA}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{EMA}_{t-1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в предыдущий момент времени, т.е. в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>EMA</code>).</p> <p>Конструкторы <code>EMA</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>EMA()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>EMA(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>EMA(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>EMA</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-4-максимум-на-отрезке-max" tabindex="-1"><a href="#_8-8-4-максимум-на-отрезке-max" class="header-anchor">#</a> 8.8.4. Максимум на отрезке (<code>Max</code>) <div class="anchor-container" data-v-72af3cd3><span id="максимум-на-отрезке-(`max`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">x</mi></mrow><mi>t</mi></msub><mo>=</mo><mi>max</mi><mo>(</mo><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathit{Max}_t = \max(p_{t}, p_{t-1}, ... , p_{t-n+1})
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">x</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{Max}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">a</span><span class="mord mathit">x</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>Max</code>).</p> <p>Конструкторы <code>Max</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>Max()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Max(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Max(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>Max</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-5-минимум-на-отрезке-min" tabindex="-1"><a href="#_8-8-5-минимум-на-отрезке-min" class="header-anchor">#</a> 8.8.5. Минимум на отрезке (<code>Min</code>) <div class="anchor-container" data-v-72af3cd3><span id="минимум-на-отрезке-(`min`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">i</mi><mi mathvariant="italic">n</mi></mrow><mi>t</mi></msub><mo>=</mo><mi>min</mi><mo>(</mo><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathit{Min}_t = \min(p_{t}, p_{t-1}, ... , p_{t-n+1})
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">i</span><span class="mord mathit">n</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">i</mi><mi mathvariant="italic">n</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{Min}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">i</span><span class="mord mathit">n</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>Min</code>).</p> <p>Конструкторы <code>Min</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>Min()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Min(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Min(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>Min</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-6-дисперсия-var" tabindex="-1"><a href="#_8-8-6-дисперсия-var" class="header-anchor">#</a> 8.8.6. Дисперсия (<code>Var</code>) <div class="anchor-container" data-v-72af3cd3><span id="дисперсия-(`var`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">V</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">r</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msup><mrow><mo fence="true">(</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub><mo>−</mo><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mrow><annotation encoding="application/x-tex">\mathit{Var}_t = \frac{1}{n}\sum_{i=0}^{n-1}{\left( p_{t - i} - \overline{p} \right) ^2}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.8011130000000004em;"></span><span class="strut bottom" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord displaystyle textstyle uncramped"><span class="minner"><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">)</span></span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">V</mi><mi mathvariant="italic">a</mi><mi mathvariant="italic">r</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{Var}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">\overline{p} = \frac{1}{n}\sum_{i=0}^{n-1}{p_{t - i}}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.854239em;"></span><span class="strut bottom" style="height:1.199239em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.276864em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.403131em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t-i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">t-i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>Var</code>).</p> <p>Конструкторы <code>Var</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>Var()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Var(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>Var(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>Var</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-7-среднеквадратическое-отклонение-stddev" tabindex="-1"><a href="#_8-8-7-среднеквадратическое-отклонение-stddev" class="header-anchor">#</a> 8.8.7. Среднеквадратическое отклонение (<code>StdDev</code>) <div class="anchor-container" data-v-72af3cd3><span id="среднеквадратическое-отклонение-(`stddev`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">t</mi><mi mathvariant="italic">d</mi><mi mathvariant="italic">D</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">v</mi></mrow><mi>t</mi></msub><mo>=</mo><msqrt><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msup><mrow><mo fence="true">(</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub><mo>−</mo><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">\mathit{StdDev}_t = \sqrt{\frac{1}{n}\sum_{i=0}^{n-1}{\left( p_{t - i} - \overline{p} \right) ^2}}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:2.203107em;"></span><span class="strut bottom" style="height:3.6550199999999995em;vertical-align:-1.4519129999999996em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.09811200000000042em;"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.665005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎷</span></span></span><span style="top:-0.24999499999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span></span></span></span><span style="top:-0.854995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span></span></span></span><span style="top:-1.459995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord reset-textstyle displaystyle textstyle cramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord displaystyle textstyle cramped"><span class="minner"><span class="minner displaystyle textstyle cramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">)</span></span><span class="vlist"><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-2.123107em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">t</mi><mi mathvariant="italic">d</mi><mi mathvariant="italic">D</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">v</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{StdDev}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">\overline{p} = \frac{1}{n}\sum_{i=0}^{n-1}{p_{t - i}}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.854239em;"></span><span class="strut bottom" style="height:1.199239em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.276864em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.403131em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t-i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">t-i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>StdDev</code>).</p> <p>Конструкторы <code>StdDev</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>StdDev()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>StdDev(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>StdDev(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>StdDev</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-8-линии-боллинджера-bb" tabindex="-1"><a href="#_8-8-8-линии-боллинджера-bb" class="header-anchor">#</a> 8.8.8. Линии Боллинджера (<code>BB</code>) <div class="anchor-container" data-v-72af3cd3><span id="линии-боллинджера-(`bb`)" data-v-72af3cd3></span></div></h3> <p>Состоит из трех значений, рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{ML}_t = \frac{1}{n} \sum_{i=0}^{n - 1}p_{t-i}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.8011130000000004em;"></span><span class="strut bottom" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop op-limits"><span class="vlist"><span style="top:1.1776689999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style="top:-1.2500050000000003em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">T</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub><mo>=</mo><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub><mo>+</mo><mi>d</mi><mo>×</mo><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">t</mi><mi mathvariant="italic">d</mi><mi mathvariant="italic">D</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">v</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{TL}_t = \mathit{ML}_t + d \times \mathit{StdDev}_t
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit">d</span><span class="mbin">×</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">B</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub><mo>=</mo><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub><mo>−</mo><mi>d</mi><mo>×</mo><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">t</mi><mi mathvariant="italic">d</mi><mi mathvariant="italic">D</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">v</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{BL}_t = \mathit{ML}_t - d \times \mathit{StdDev}_t
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">d</span><span class="mbin">×</span><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">M</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{ML}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">T</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{TL}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">B</mi><mi mathvariant="italic">L</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{BL}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">L</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значения искомых величин в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">S</mi><mi mathvariant="italic">t</mi><mi mathvariant="italic">d</mi><mi mathvariant="italic">D</mi><mi mathvariant="italic">e</mi><mi mathvariant="italic">v</mi></mrow><mi>t</mi></msub><mo>=</mo><msqrt><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msup><mrow><mo fence="true">(</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub><mo>−</mo><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">\mathit{StdDev}_t = \sqrt{\frac{1}{n}\sum_{i=0}^{n-1}{\left( p_{t - i} - \overline{p} \right) ^2}}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.2396295em;"></span><span class="strut bottom" style="height:1.84002em;vertical-align:-0.6003905em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.04962949999999999em;"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size2">√</span></span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord reset-textstyle textstyle cramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.276864em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.403131em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord textstyle cramped"><span class="minner"><span class="minner textstyle cramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">(</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;">)</span></span><span class="vlist"><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-1.1596294999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mi>p</mi></mrow><mo stretchy="true">‾</mo></mover><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>n</mi></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">\overline{p} = \frac{1}{n}\sum_{i=0}^{n-1}{p_{t - i}}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.854239em;"></span><span class="strut bottom" style="height:1.199239em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="overline mord"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">p</span></span></span><span style="top:-0.5505599999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped overline-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.276864em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.403131em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t-i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">t-i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathit">i</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span></span></span></span> - константа;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>BB</code>).</p> <p>Конструкторы <code>BB</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>BB()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>BB(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>BB(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>BB</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>double d() const</td> <td>Получить <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span></span></span></span></td></tr> <tr><td>void set_d(double d)</td> <td>Задать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span></span></span></span>, значение данного параметра должно быть дробным числом из отрезка <code>[1, 1000]</code> (значение по умолчанию 4), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение ML индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>double tl() const</td> <td>Получить текущее значение TL индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>double ml() const</td> <td>Получить текущее значение ML индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>double bl() const</td> <td>Получить текущее значение BL индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h3 id="_8-8-9-индекс-относительнои-силы-rsi" tabindex="-1"><a href="#_8-8-9-индекс-относительнои-силы-rsi" class="header-anchor">#</a> 8.8.9. Индекс относительной силы (<code>RSI</code>)<div class="anchor-container" data-v-72af3cd3><span id="indicators-rsi" data-v-72af3cd3></span><span id="индекс-относительной-силы-(`rsi`)" data-v-72af3cd3></span></div></h3> <p>Рассчитывается по формуле:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">R</mi><mi mathvariant="italic">S</mi><mi mathvariant="italic">I</mi></mrow><mi>t</mi></msub><mo>=</mo><mn>1</mn><mn>0</mn><mn>0</mn><mo>−</mo><mfrac><mrow><mn>1</mn><mn>0</mn><mn>0</mn></mrow><mrow><mn>1</mn><mo>+</mo><msub><mrow><mi mathvariant="italic">R</mi><mi mathvariant="italic">S</mi></mrow><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathit{RSI}_t = 100 - \frac{100}{1 + \mathit{RS}_t}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.32144em;"></span><span class="strut bottom" style="height:2.1574400000000002em;vertical-align:-0.8360000000000001em;"></span><span class="base displaystyle textstyle uncramped"><span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.07847em;">I</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mbin">−</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">1</span><span class="mbin">+</span><span><span class="mord textstyle cramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p> <p>где <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">R</mi><mi mathvariant="italic">S</mi><mi mathvariant="italic">I</mi></mrow><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathit{RSI}_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.07847em;">I</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение искомой величины в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">R</mi><mi mathvariant="italic">S</mi></mrow><mrow><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>E</mi><mi>M</mi><mi>A</mi><mi mathvariant="normal">_</mi><mi>G</mi><mi>A</mi><mi>I</mi><msub><mi>N</mi><mi>t</mi></msub></mrow><mrow><mi>E</mi><mi>M</mi><mi>A</mi><mi mathvariant="normal">_</mi><mi>L</mi><mi>O</mi><mi>S</mi><msub><mi>S</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathit{RS}_{t} = \frac{EMA\_GAIN_t}{EMA\_LOSS_t}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.005331em;"></span><span class="strut bottom" style="height:1.5673309999999998em;vertical-align:-0.5619999999999999em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:-0.05764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.527em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit">G</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:-0.10903em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">G</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">I</mi><mi mathvariant="italic">N</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>2</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>(</mo><msub><mi>G</mi><mi>t</mi></msub><mo>−</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">G</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">I</mi><mi mathvariant="italic">N</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>+</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">G</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">I</mi><mi mathvariant="italic">N</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{EMA\_GAIN}_t = \frac{2}{n + 1} (G_t - \mathit{EMA\_GAIN}_{t-1}) + \mathit{EMA\_GAIN}_{t-1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">G</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">2</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">G</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">G</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">G</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">L</mi><mi mathvariant="italic">O</mi><mi mathvariant="italic">S</mi><mi mathvariant="italic">S</mi></mrow><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mn>2</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo>(</mo><msub><mi>L</mi><mi>t</mi></msub><mo>−</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">L</mi><mi mathvariant="italic">O</mi><mi mathvariant="italic">S</mi><mi mathvariant="italic">S</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>+</mo><msub><mrow><mi mathvariant="italic">E</mi><mi mathvariant="italic">M</mi><mi mathvariant="italic">A</mi><mi mathvariant="italic">_</mi><mi mathvariant="italic">L</mi><mi mathvariant="italic">O</mi><mi mathvariant="italic">S</mi><mi mathvariant="italic">S</mi></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathit{EMA\_LOSS}_t = \frac{2}{n + 1} (L_t - \mathit{EMA\_LOSS}_{t-1}) + \mathit{EMA\_LOSS}_{t-1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="base textstyle uncramped"><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">2</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mord mathit">_</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>G</mi><mrow><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><msub><mi>p</mi><mi>t</mi></msub><mo>−</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><msub><mi>p</mi><mi>t</mi></msub><mo>≥</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><msub><mi>p</mi><mi>t</mi></msub><mo>&lt;</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">G_{t} = \begin{cases} 
     p_t - p_{t-1}, &amp;\text{if}\enspace p_t \ge p_{t-1}\\
     0, &amp;\text{if}\enspace p_t &lt; p_{t-1} 
   \end{cases}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">G</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">0</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≥</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&lt;</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>p</mi><mi>t</mi></msub><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><msub><mi>p</mi><mi>t</mi></msub><mo>≤</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><msub><mi>p</mi><mi>t</mi></msub><mo>&gt;</mo><msub><mi>p</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">L_{t} = \begin{cases} 
     p_{t-1} - p_t, &amp;\text{if}\enspace p_t \le p_{t-1}\\
     0, &amp;\text{if}\enspace p_t &gt; p_{t-1} 
   \end{cases}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathrm">0</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≤</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&gt;</span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{t}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> - значение исходной функции (цены) в момент времени <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span>;</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n + 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span> - количество значений исходной функции (цены) для расчета искомой величины (<code>RSI</code>).</p> <p>Конструкторы <code>RSI</code>:</p> <table><thead><tr><th>Конструктор</th> <th>Описание</th></tr></thead> <tbody><tr><td>RSI()</td> <td>создать объект с пустым раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>RSI(std::vector&lt;interval&gt; sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr> <tr><td>RSI(schedule sch)</td> <td>создать объект c раписанием и с <code>TradingDays</code> портфеля</td></tr></tbody></table> <p>Методы <code>RSI</code>:</p> <table><thead><tr><th>Метод</th> <th>Описание</th></tr></thead> <tbody><tr><td>size_t length() const</td> <td>Получить количество элементов для расчета (парметр <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> из формулы)</td></tr> <tr><td>void set_length(size_t n)</td> <td>Задать количество элементов для расчета, значение данного параметра должно быть целым числом из отрезка <code>[1, 10000]</code> (значение по умолчания 10), в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>size_t timeframe() const</td> <td>Получить тайм-фрейм расчетов, т.е. с какой периодичностью получать <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></td></tr> <tr><td>void set_timeframe(size_t timeframe)</td> <td>Задать тайм-фрейм для расчетов (в секундах), значение данного параметра должно быть целым числом из отрезка <code>[1, 86400]</code> (значение по умолчанию 1 секунда), в противном случае будет выброшено исключение <code>std::invalid_argument</code>. При изменении таймфрейма накопленная для расчетов очередь значений очищается</td></tr> <tr><td>int trading_days() const</td> <td>Получить <code>TradingDays</code> индикатора</td></tr> <tr><td>void set_trading_days(int trading_days)</td> <td>Задать <code>TradingDays</code>, значение данного параметра должно быть целым числом из отрезка <code>[0, 127]</code>, в противном случае будет выброшено исключение <code>std::invalid_argument</code></td></tr> <tr><td>bool update(double p)</td> <td>Добавить новое значение <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{i}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> для расчета. Если тайм-фрейм истек, то новое значение будет добавлено и функция вернет <code>true</code>, иначе <code>false</code></td></tr> <tr><td>double value() const</td> <td>Получить текущее значение индикатора. Если список элементов для расчета индикатора пуст, то будет выброшено исключение <code>std::out_of_range</code></td></tr> <tr><td>void clear()</td> <td>Очистить список элементов по которым считается значение индикатора</td></tr> <tr><td>bool empty()</td> <td>Проверить на пустоту список элементов по которым считается значение индикатора</td></tr> <tr><td>size_t size()</td> <td>Получить размер списка элементов по которым считается значение индикатора</td></tr> <tr><td>void shift(double p)</td> <td>Прибавить заданное значение ко всем элементам списка по которым считается значение индикатора и пересчитать значение индикатора по новым значениям</td></tr></tbody></table> <h2 id="_8-9-примеры-доступа-к-параметрам-портфеля-инструмента-сделки-позиции" tabindex="-1"><a href="#_8-9-примеры-доступа-к-параметрам-портфеля-инструмента-сделки-позиции" class="header-anchor">#</a> 8.9. Примеры доступа к параметрам портфеля, инструмента, сделки, позиций <div class="anchor-container" data-v-72af3cd3><span id="примеры-доступа-к-параметрам-портфеля,-инструмента,-сделки,-позиций" data-v-72af3cd3></span></div></h2> <p>Пусть имеется портфель с именем &quot;si&quot; и в этом портфеле есть один инструмент - фьючерс на доллар &quot;SiH6&quot;. Для того, чтобы получить, например, бид и объем бида по бумаге портфеля и сложить эти значения в переменные, надо написать следующий код:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> bid <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> amount_bid <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">amount_bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>Чтобы получить, например, позицию и сигнал на покупку портфеля надо написать:</p> <div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> lim_buy <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">lim_b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> pos <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__sec_status_check__" data-v-72af3cd3></span></div>Чтобы проверить, например, что в данный момент по инструменту можно выставлять заявки и в роботе есть активное подключение, получающее стаканы:
<div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">trading_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> TRADING_CAN_PLACE<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">conn_online</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> MARKET_DATA_OB_ONLINE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// TODO place your code here</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>Позицию портфеля можно посчитать самому, разделив позицию главной бумаги портфеля на ее вес в портфеле, вот так:</p> <div class="language-C extra-class"><pre class="language-c"><code>security_fields sf <span class="token operator">=</span> <span class="token function">get_security_fields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> pos <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> sf<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>Для подсчета раздвижки по сделкам портфеля можно использовать формулу:</p> <div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">deal</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>price<span class="token punctuation">;</span>
</code></pre></div><hr> <p>Сохранить и загрузить значение из data можно так:</p> <div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token string">&quot;si&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__Example1__" data-v-72af3cd3></span></div>Чтобы получить, например, цену последней сделки для бумаги с СПб биржи (получение цены последней сделки по ключу возможно только для СПБ биржи):
<div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SPB_AGGR_AAPL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spb_commons<span class="token operator">&amp;</span> c <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">spb_common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> p <span class="token operator">=</span> c<span class="token punctuation">.</span>price_last<span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__Example2__" data-v-72af3cd3></span></div>Чтобы, например, задать и потом получить значение &quot;пользовательского поля#0&quot;:
<div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">set_uf0</span><span class="token punctuation">(</span><span class="token function">user_value</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user_value<span class="token operator">&amp;</span> v <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">uf0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>Чтобы найти, например, средневзвешенный бид по первым 10-ти элементам стакана (настоятельно НЕ рекомендуется искать что-то по всему стакану, т.к. стакан меняется часто, то работать ваш код будет долго):</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">double</span> sum1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> avg_bid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SPB_AGGR_AAPL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
order_book ob <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">orderbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ob<span class="token punctuation">.</span><span class="token function">is_available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span><span class="token function">has_next_bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        std<span class="token operator">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> ob<span class="token punctuation">.</span><span class="token function">next_bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum1 <span class="token operator">+=</span> b<span class="token punctuation">.</span>first <span class="token operator">*</span> b<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
        sum2 <span class="token operator">+=</span> b<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
avg_bid <span class="token operator">=</span> <span class="token punctuation">(</span>sum2 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>sum1 <span class="token operator">/</span> sum2<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__Example3__" data-v-72af3cd3></span></div>Чтобы пройти в цикле по всем бумагам портфеля и вывести имена бумаг в лог:
<div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">restart_sec_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">has_next_sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    security_fields sf <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">next_sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log_info</span><span class="token punctuation">(</span>sf<span class="token punctuation">.</span><span class="token function">sec_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>Чтобы найти, например, сумму объемов активных заявок портфеля по бумаге по заданной цене 100:</p> <div class="language-C extra-class"><pre class="language-c"><code>security_fields sf <span class="token operator">=</span> <span class="token function">get_security_fields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
order_pool p <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">orders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> amount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">has_next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    order_item o <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>status <span class="token operator">==</span> RUNNING <span class="token operator">&amp;&amp;</span> <span class="token function">fabs</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>price <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-9</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        amount <span class="token operator">+=</span> o<span class="token punctuation">.</span>amount_rest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>Чтобы найти, например, текущую позицию по бумаге и текущий баланс по валюте:</p> <div class="language-C extra-class"><pre class="language-c"><code>connection c <span class="token operator">=</span> <span class="token function">get_connection</span><span class="token punctuation">(</span><span class="token string">&quot;okex_send_test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
coin_item ci <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">coin</span><span class="token punctuation">(</span><span class="token string">&quot;BTC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sec_item si <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">sec</span><span class="token punctuation">(</span><span class="token string">&quot;isolated/BTC-USD-SWAP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> coin_pos <span class="token operator">=</span> ci<span class="token punctuation">.</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> sec_pos <span class="token operator">=</span> si<span class="token punctuation">.</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="_8-10-примеры-использования-функции-и-классов" tabindex="-1"><a href="#_8-10-примеры-использования-функции-и-классов" class="header-anchor">#</a> 8.10. Примеры использования функций и классов <div class="anchor-container" data-v-72af3cd3><span id="примеры-использования-функций-и-классов" data-v-72af3cd3></span></div></h2> <p>Пусть имеется портфель с именем &quot;test&quot; и в этом портфеле есть два инструмента: фьючерс на индекс РТС &quot;RIH6&quot; и его опцион <code>call</code> на страйк 70000 &quot;RI70000BB6&quot;, позиция по обоим бумагам в портфеле равна 1, а направление торговли у обоих <a href="/bot-doc/docs/05-params-description.html#_5-3-10-on-buy">On_by</a> = <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a>.</p> <p>Рассчитаем дельту одного из инструментов портфеля, например, &quot;RIH6&quot;. Для этого воспользуемся функцией delta из модуля options. Дельта для фьючерса всегда равна 1, проверим, для этого надо написать:</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">return</span> <span class="token function">S_delta</span><span class="token punctuation">(</span><span class="token string">&quot;RIH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>и выполнить этот код, в результате получим 1. Если хотим рассчитать дельту с учетом ставки рефинансирования, то укажем необязательный параметр rr, например, равный 6.25%:</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">return</span> <span class="token function">P_delta</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>здесь test - имя портфеля (для портфелей с другими именами нужно писать их имена). Дельта всего портфеля будет равна сумме дельт его инструментов с учетом позиции и направления торговли:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="normal">Δ</mi><mrow><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>f</mi><mi>o</mi><mi>l</mi><mi>i</mi><mi>o</mi></mrow></msub><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>f</mi><mi>o</mi><mi>l</mi><mi>i</mi><mi>o</mi></mrow></msub><msub><mi mathvariant="normal">Δ</mi><mi>i</mi></msub><mo>×</mo><mi>p</mi><mi>o</mi><msub><mi>s</mi><mi>i</mi></msub><mo>×</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>O</mi><mi>n</mi><mspace width="0.5em"></mspace><mi>b</mi><mi>u</mi><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>B</mi><mi>u</mi><mi>y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mo>−</mo><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>O</mi><mi>n</mi><mspace width="0.5em"></mspace><mi>b</mi><mi>u</mi><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>S</mi><mi>e</mi><mi>l</mi><mi>l</mi></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\Delta_{portfolio}=\sum_{i\in portfolio}\Delta_i \times pos_i \times 
    \begin{cases}
      1, &amp;\text{if}\enspace On\enspace buy_i=Buy\\
     -1, &amp;\text{if}\enspace On\enspace buy_i=Sell 
\end{cases}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.188221em;vertical-align:-1.438221em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathrm">Δ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">o</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.202113em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">∈</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">o</span></span></span></span><span style="top:-0.000005000000000032756em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathrm">Δ</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit">n</span><span class="mord mspace enspace"></span><span class="mord mathit">b</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="text mord displaystyle textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit">n</span><span class="mord mspace enspace"></span><span class="mord mathit">b</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p> <p>где i - i-тый инструмент портфеля, Δi - дельта i-го инструмента портфеля, posi - позиция i-го инструмента портфеля, On buyi - On buy i-го инструмента портфеля. Величины гамма, вега, тета и ожидаемая волатильность для портфеля рассчитываются аналогично. Функции для их рассчета вызываются аналогично примеру с дельтой. Функция price так же вызывается аналогично delta, но НЕ может быть вызвана для портфеля, может быть вызвана только для финансового инструмента.</p> <hr> <p>Теперь рассмотрим пример использования функций, которые позволяют более &quot;гибко&quot; рассчитывать необходимые величины, так как им на вход можно передать более широкий набор аргументов, но эти функции работают исключительно для опционов и при использовании этих функций необходимо четко знать для опциона <code>call</code> или для опциона <code>put</code> вы хотите рассчитать значение. Например, рассчитаем ожидаемую волатильность опциона &quot;RI70000BB6&quot;, в качестве цен опциона и базового актива возьмем их лучшие цены на покупку:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s1 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;RIH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
security s2 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;RI70000BB6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">CIV</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">strike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">exp_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__Example4__" data-v-72af3cd3></span></div>Чтобы проверить, что текущее время меньше полудня:
<div class="language-C extra-class"><pre class="language-c"><code>day_time t <span class="token operator">=</span> <span class="token function">get_day_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
day_time <span class="token function">t1</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> t <span class="token operator">&lt;</span> t1<span class="token punctuation">;</span>
</code></pre></div><hr> <div class="anchor-container" data-v-72af3cd3><span id="__Example7__" data-v-72af3cd3></span></div>Пример тaймера на каждые 10 секунд:
<div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">static</span> timers<span class="token operator">::</span>timer <span class="token function">t</span><span class="token punctuation">(</span><span class="token number">10000000000LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// do some operation</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>Пример вызова операции ежедневно не ранее, чем в <code>10:00</code>:</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">static</span> timers<span class="token operator">::</span>day_timer <span class="token function">t</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// do some operation</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>Пример получения и изменения &quot;пользовательских полей&quot; (увеличить значение <code>i</code>-го поля на <code>i</code>):<div class="anchor-container" data-v-72af3cd3><span id="__Example6__" data-v-72af3cd3></span></div></p> <div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">double</span> v <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">invoke</span><span class="token punctuation">(</span>uf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get value</span>
    std<span class="token operator">::</span><span class="token function">invoke</span><span class="token punctuation">(</span>set_uf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token function">user_value</span><span class="token punctuation">(</span>v <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// set value</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="_8-11-примеры-написания-ratio-buy-sell-formula" tabindex="-1"><a href="#_8-11-примеры-написания-ratio-buy-sell-formula" class="header-anchor">#</a> 8.11. Примеры написания Ratio buy/sell formula <div class="anchor-container" data-v-72af3cd3><span id="примеры-написания-ratio-buy/sell-formula" data-v-72af3cd3></span></div></h2> <p>При написании формул можно использовать все те инструменты, которые используются в любом из портфелей, также можно использовать доступные значения других портфелей , например, их позиции по бумагам.</p> <p>Для того, чтобы использовать поле <a href="/bot-doc/docs/05-params-description.html#_5-3-28-ratio-buy-formula">Ratio sell/buy formula</a> необходимо для выбранного инструмента портфеля выбрать <a href="/bot-doc/docs/05-params-description.html#_5-3-27-ratio-type">Ratio type</a> = <code>Ratio formula</code>. После этого двойным кликом войти в редактор и написать необходимое значение.</p> <p>Пусть имеется портфель с именем &quot;si&quot; и в этом портфеле есть один инструмент - фьючерс на доллар &quot;SiH6&quot;, направление торговли этого инструмента <a href="/bot-doc/docs/05-params-description.html#_5-3-10-on-buy">On by</a> = <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a>.</p> <p>Если <a href="/bot-doc/docs/05-params-description.html#_5-3-19-ratio-sign">Ratio sign</a> = &quot;×&quot;, то ничего особо интересного с формулами не придумаешь, разве что какой-то хитрый множитель (и для покупки и для продажи), например, такой:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>в таком случае для расчета <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a> будет использован один и тот же множитель, если же вы хотите использовать разные множители надо вписать разные значения в <a href="/bot-doc/docs/05-params-description.html#_5-3-28-ratio-buy-formula">Ratio buy formula</a> и <a href="/bot-doc/docs/05-params-description.html#_5-3-29-ratio-buy-formula">Ratio sell formula</a>, например, так:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>для покупки и продажи, соответственно.</p> <p>В таком случае для расчета <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> будет использован квадратный корень из бида, а для расчета <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a> будет использован квадратный корень из оффера.</p> <p>Если же <a href="/bot-doc/docs/05-params-description.html#_5-3-19-ratio-sign">Ratio sign</a> = &quot;+&quot;, то вы можете полностью изменить формулу расчета <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a>, для этого надо для начала вычесть те значения, которые используются в данный момент, тем самым обнулив <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a>:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>для покупки и продажи, соответственно, а после этого прибавить к <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a> новое значение, например, так:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> price <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
</code></pre></div><p>и</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> price <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
</code></pre></div><p>теперь значения переменной <code>price</code> при расчете каждого из параметров будут новыми значениями для <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a>. Хочется отметить, что без использования <code>Ratio formula</code> такое &quot;хитрое&quot; значение получить бы не удалось.</p> <hr> <p>Рассмотрим еще один пример. Пусть имеется портфель с именем &quot;test&quot; и в этом портфеле есть два инструмента: фьючерс на доллар &quot;SiH6&quot;, направление торговли этого инструмента <a href="/bot-doc/docs/05-params-description.html#_5-3-10-on-buy">On_by</a> = <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и он является <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> и фьючерс на индекс РТС &quot;RIH6&quot;, направление торговли этого инструмента тоже <a href="/bot-doc/docs/05-params-description.html#_5-3-10-on-buy">On_by</a> = <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> (для примера направление не <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> инструмента значения не имеет). Для того чтобы использовать эти два инструмента в одном портфеле нужно привести их цены в пунктах к одной размерности, как известно, доллар торгуется в рублях (1 : pt = 1 rub), а вот индекс торгуется не в рублях, для него 1 pt = 0.02 * <code>$</code><sub>price</sub> rub (где <code>$</code><sub>price</sub> - это курс доллара в рублях, но это не константа, а динамически изменяющаяся величина). Есть два варианта решения поставленной задачи, оба реализуемы только с использованием <code>Ratio formula</code> и оба приводят к абсолютно одинаковому результату. Вот они:</p> <ol><li><p>Для доллара просто зададим <a href="/bot-doc/docs/05-params-description.html#_5-3-20-ratio">Ratio</a> = 1, а вот для индекса РТС выберем <a href="/bot-doc/docs/05-params-description.html#_5-3-19-ratio-sign">Ratio sign</a> = &quot;×&quot;, а в <a href="/bot-doc/docs/05-params-description.html#_5-3-28-ratio-buy-formula">Ratio buy formula</a> напишем следующее:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0.02</span> <span class="token operator">*</span> s<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>в <code>Ratio sell formula</code> напишем следующее:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0.02</span> <span class="token operator">*</span> s<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>таким образом при расчете <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> мы будем использовать бид доллара, а при расчете <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a> - его оффер, и величину получим в рублях.</p></li> <li><p>Для доллара просто зададим <a href="/bot-doc/docs/05-params-description.html#_5-3-20-ratio">Ratio</a> = 1, а вот для индекса РТС выберем <a href="/bot-doc/docs/05-params-description.html#_5-3-19-ratio-sign">Ratio sign</a> = &quot;+&quot;, а в <a href="/bot-doc/docs/05-params-description.html#_5-3-28-ratio-buy-formula">Ratio buy formula</a> напишем следующее (вначале обнулим значение, как в предыдущем примере, а затем зададим новое):</p> <div class="language-C extra-class"><pre class="language-c"><code>security s1 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
security s2 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;RIH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> price <span class="token operator">=</span> s2<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.02</span> <span class="token operator">*</span> s1<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s2<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
</code></pre></div><p>в <a href="/bot-doc/docs/05-params-description.html#_5-3-29-ratio-buy-formula">Ratio sell formula</a> напишем следующее:</p> <div class="language-C extra-class"><pre class="language-c"><code>security s1 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;SiH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
security s2 <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token string">&quot;RIH6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> price <span class="token operator">=</span> s2<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.02</span> <span class="token operator">*</span> s1<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">-</span>s2<span class="token punctuation">.</span><span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
</code></pre></div><p>теперь значения переменной price и будут новыми значениями (так сказать, со стороны индекса РТС), используемыми для расчета <a href="/bot-doc/docs/05-params-description.html#p.buy">Buy</a> и <a href="/bot-doc/docs/05-params-description.html#p.sell">Sell</a>, соответственно.</p></li></ol> <h2 id="_8-12-примеры-использования-индикаторов" tabindex="-1"><a href="#_8-12-примеры-использования-индикаторов" class="header-anchor">#</a> 8.12. Примеры использования индикаторов<div class="anchor-container" data-v-72af3cd3><span id="__Example5__" data-v-72af3cd3></span><span id="примеры-использования-индикаторов" data-v-72af3cd3></span></div></h2> <p>Самый простой пример расчета <code>SMA</code> без каких-либо дополнительных настроек (т.е. тайм-фрейм 1 секунда и 10 значений для усреднения):</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get main security</span>
<span class="token keyword">static</span> indicators<span class="token operator">::</span>SMA sma<span class="token punctuation">;</span><span class="token comment">// initialize SMA object as static variable</span>
sma<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">mid_price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// try to update SMA value, by adding new price</span>
<span class="token keyword">return</span> sma<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get current SMA value</span>
</code></pre></div><hr> <p>Пример расчета <code>EMA</code> с использованием расписания (<code>TradingDays</code> берутся из портфеля, тайм-фрейм 1 секунда и 10 значений для усреднения):</p> <div class="language-C extra-class"><pre class="language-c"><code>security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get main security</span>
<span class="token keyword">static</span> indicators<span class="token operator">::</span>EMA <span class="token function">ema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// initialize EMA with trading schedule: 7:00-18:45, 19:00-23:50</span>
ema<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">mid_price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// try to update EMA value, by adding new price</span>
<span class="token keyword">return</span> ema<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get current EMA value</span>
</code></pre></div><hr> <p>Пример расчета <code>Var</code> с использованием значений пользовательских полей для настройки параметров индикатора и с обработкой отсутствия цен по заданной бумаге:</p> <div class="language-C extra-class"><pre class="language-c"><code>portfolio p <span class="token operator">=</span> <span class="token function">get_portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get current portfolio</span>
user_value td <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">uf0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get TradingDays value from user field 0</span>
user_value len <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">uf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get length value from user field 1</span>
user_value tf <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">uf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get timeframe value from user field 2</span>
security s <span class="token operator">=</span> <span class="token function">get_security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get main security</span>

<span class="token keyword">static</span> indicators<span class="token operator">::</span>Var <span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// initialize Var with trading schedule: 7:00-23:00</span>
v<span class="token punctuation">.</span><span class="token function">set_timeframe</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// set timeframe value from user field 2</span>
v<span class="token punctuation">.</span><span class="token function">set_length</span><span class="token punctuation">(</span>len<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// set length value from user field 1</span>
v<span class="token punctuation">.</span><span class="token function">set_trading_days</span><span class="token punctuation">(</span>td<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// set TradingDays value from user field 0</span>

try<span class="token comment">// try to catch exception</span>
<span class="token punctuation">{</span>
    v<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">mid_price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// try to update Var value, by adding new price</span>
<span class="token punctuation">}</span>
<span class="token function">catch</span><span class="token punctuation">(</span>std<span class="token operator">::</span>range_error<span class="token operator">&amp;</span> e<span class="token punctuation">)</span><span class="token comment">// if there is no mid_price value simply return -1</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// get current Var value</span>
</code></pre></div><hr> <p>Примеры задания <code>TradingDays</code> индикатора:</p> <div class="language-C extra-class"><pre class="language-c"><code>sma<span class="token punctuation">.</span><span class="token function">set_trading_days</span><span class="token punctuation">(</span>WD_MONDAY <span class="token operator">|</span> WD_TUESDAY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// compute indicator value on Monday and Tuesday only</span>
sma<span class="token punctuation">.</span><span class="token function">set_trading_days</span><span class="token punctuation">(</span>WORK_WEEK<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// compute indicator value from Monday till Friday</span>
sma<span class="token punctuation">.</span><span class="token function">set_trading_days</span><span class="token punctuation">(</span>WHOLE_WEEK <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span> WD_MONDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// compute indicator value from Tuesday till Sunday</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bot-doc/docs/07-order-error.html" class="prev">
        7. Ошибки заявок
      </a></span> <span class="next"><a href="/bot-doc/docs/09-faq.html">
        9. Часто задаваемые вопросы
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/bot-doc/assets/js/app.e81ab8fa.js" defer></script><script src="/bot-doc/assets/js/3.5b3b6265.js" defer></script><script src="/bot-doc/assets/js/13.1823ce22.js" defer></script><script src="/bot-doc/assets/js/10.8c8ad779.js" defer></script>
  </body>
</html>
