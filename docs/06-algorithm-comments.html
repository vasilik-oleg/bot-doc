<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6. Примечания к алгоритму | Документация торговых роботов компании &quot;Викинг&quot;</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <link rel="icon" href="/bot-doc/favicon.ico">
    <meta name="description" content="Руководство пользователя, описание алгоритма и API">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/bot-doc/assets/css/0.styles.cb6403b3.css" as="style"><link rel="preload" href="/bot-doc/assets/js/app.e81ab8fa.js" as="script"><link rel="preload" href="/bot-doc/assets/js/3.5b3b6265.js" as="script"><link rel="preload" href="/bot-doc/assets/js/16.9bde9826.js" as="script"><link rel="preload" href="/bot-doc/assets/js/10.8c8ad779.js" as="script"><link rel="prefetch" href="/bot-doc/assets/js/11.55febb22.js"><link rel="prefetch" href="/bot-doc/assets/js/12.d623e0fe.js"><link rel="prefetch" href="/bot-doc/assets/js/13.1823ce22.js"><link rel="prefetch" href="/bot-doc/assets/js/14.ad5d64ed.js"><link rel="prefetch" href="/bot-doc/assets/js/15.9af162a9.js"><link rel="prefetch" href="/bot-doc/assets/js/17.ee50ca3e.js"><link rel="prefetch" href="/bot-doc/assets/js/18.87554097.js"><link rel="prefetch" href="/bot-doc/assets/js/19.9fcead24.js"><link rel="prefetch" href="/bot-doc/assets/js/4.69016f4b.js"><link rel="prefetch" href="/bot-doc/assets/js/5.74b65c17.js"><link rel="prefetch" href="/bot-doc/assets/js/6.8be4ae1f.js"><link rel="prefetch" href="/bot-doc/assets/js/7.fcd9b261.js"><link rel="prefetch" href="/bot-doc/assets/js/8.18baa8b6.js"><link rel="prefetch" href="/bot-doc/assets/js/9.f3d86c02.js"><link rel="prefetch" href="/bot-doc/assets/js/vendors~docsearch.30c42ed6.js">
    <link rel="stylesheet" href="/bot-doc/assets/css/0.styles.cb6403b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bot-doc/" class="home-link router-link-active"><img src="/bot-doc/images/vkg_logo.svg" alt="Документация торговых роботов компании &quot;Викинг&quot;" class="logo"> <span class="site-name can-hide">Документация торговых роботов компании &quot;Викинг&quot;</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bot-doc/docs/" class="nav-link router-link-active">
  Документация
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bot-doc/docs/" class="nav-link router-link-active">
  Документация
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bot-doc/docs/01-change-history.html" class="sidebar-link">1. История изменений</a></li><li><a href="/bot-doc/docs/02-introduction.html" class="sidebar-link">2. Введение</a></li><li><a href="/bot-doc/docs/03-getting-started.html" class="sidebar-link">3. Начало работы</a></li><li><a href="/bot-doc/docs/04-creating-connection.html" class="sidebar-link">4. Добавление подключений</a></li><li><a href="/bot-doc/docs/05-params-description.html" class="sidebar-link">5. Описание параметров</a></li><li><a href="/bot-doc/docs/06-algorithm-comments.html" aria-current="page" class="active sidebar-link">6. Примечания к алгоритму</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-1-особенности-использования-торговых-стаканов" class="sidebar-link">6.1. Особенности использования торговых стаканов</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-2-использование-приказа-переместить-заявку" class="sidebar-link">6.2. Использование приказа переместить заявку</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-3-правила-перемещения-lim-sell-и-lim-buy" class="sidebar-link">6.3. Правила перемещения LimSell и LimBuy</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-4-особенности-поведения-заявок-переставленных-по-sl-или-timer" class="sidebar-link">6.4. Особенности поведения заявок, переставленных по SL или Timer</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-5-подсчет-финансового-результата" class="sidebar-link">6.5. Подсчёт финансового результата</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-6-о-ценах-выставления-заявок-второи-ноги" class="sidebar-link">6.6. О ценах выставления заявок второй ноги</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-7-об-объемах-выставления-заявок" class="sidebar-link">6.7. Об объёмах выставления заявок</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-8-участие-пользователя-во-внутренних-тестированиях-проводимых-moex" class="sidebar-link">6.8. Участие пользователя во внутренних тестированиях, проводимых MOEX</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-9-алгоритм-робота-в-синтетических-стаканах" class="sidebar-link">6.9. Алгоритм робота в синтетических стаканах</a></li><li class="sidebar-sub-header"><a href="/bot-doc/docs/06-algorithm-comments.html#_6-10-сделки-с-отметкои-aggregated" class="sidebar-link">6.10. Сделки с отметкой Aggregated</a></li></ul></li><li><a href="/bot-doc/docs/07-order-error.html" class="sidebar-link">7. Ошибки заявок</a></li><li><a href="/bot-doc/docs/08-c-api.html" class="sidebar-link">8. C++</a></li><li><a href="/bot-doc/docs/09-faq.html" class="sidebar-link">9. Часто задаваемые вопросы</a></li><li><a href="/bot-doc/docs/10-api.html" class="sidebar-link">10.API фронта 2.0</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_6-примечания-к-алгоритму" tabindex="-1"><a href="#_6-примечания-к-алгоритму" class="header-anchor">#</a> 6. Примечания к алгоритму <div class="anchor-container" data-v-72af3cd3><span id="примечания-к-алгоритму" data-v-72af3cd3></span></div></h1> <p>На данной странице собраны подробные описания неочевидных моментов работы алгоритма робота.</p> <h2 id="_6-1-особенности-использования-торговых-стаканов" tabindex="-1"><a href="#_6-1-особенности-использования-торговых-стаканов" class="header-anchor">#</a> 6.1. Особенности использования торговых стаканов <div class="anchor-container" data-v-72af3cd3><span id="особенности-использования-торговых-стаканов" data-v-72af3cd3></span></div></h2> <p>В роботе для получения цен используются таблицы/потоки торговых стаканов по инструментам. Особенность работы со стаканами такова, что стакан не приходит с биржи в готовом виде. Чтобы минимизировать объём пересылаемой информации биржа присылает сначала снимок/слепок стакана по инструменту на какой-то момент времени, а потом приходят только обновления, сообщающие об изменениях в стакане. Робот НЕ строит стакан сразу по всем бумагам, стакан строится только по используемым в портфелях бумагам. Поэтому, для добавления новой бумаги в список бумаг, по которым строится стакан, необходимо переоткрыть поток с текущим слепком, а потом применять к нему обновления из потока инкрементальных обновлений. В момент получения потока со слепком, стакан в роботе временно перестает обновляться по всем используемым бумагам. Он начнет обновляться только после того как будет закрыт поток со слепком (это может занять некоторое время, зависящее от общего количества бумаг, приходящих в данном потоке, и размера стаканов) и начнут применяться инкрементальные обновления. Соответственно, в момент переоткрытия стакана вы можете наблюдать отсутствие цен по бумагам. Переоткрытие требуется в большинстве подключений, потому что стаканы по всем бумагам или полный лог заявок приходят, как правило, в одном потоке, т.е. нельзя получать данные по конкретным бумагам, получать вы всегда будете все данные, а использовать можете только для нужных бумаг.</p> <p>Стакан в роботе может переоткрываться в следующих случаях:</p> <ul><li>создание нового портфеля;</li> <li>добавление бумаги в портфель;</li> <li>снятие флага <code>Disabled</code> с портфеля;</li> <li>пропуски в номерах сообщений инкрементального потока обновлений стакана в UDP подключениях к биржам (чем больше у вас портфелей и бумаг, тем выше вероятность возникновения этих пропусков).</li></ul> <p>Т.е. произойдёт приостановка торговли по всем портфелям, использующим инструменты данной биржи. Это не является ошибочным поведением робота.</p> <h2 id="_6-2-использование-приказа-переместить-заявку" tabindex="-1"><a href="#_6-2-использование-приказа-переместить-заявку" class="header-anchor">#</a> 6.2. Использование приказа переместить заявку <div class="anchor-container" data-v-72af3cd3><span id="использование-приказа-переместить-заявку" data-v-72af3cd3></span></div></h2> <p>На некоторых подключениях реализована отправка приказа переместить заявку (иногда эта команда также называется изменением заявки). Использование данного приказа позволяет сократить количество транзакций и увеличить отношение количества сделок к количеству транзакций, особенно при котировании, а так же увеличить время нахождения заявок в рынке. Так как особенности использования данной команды отличаются на разных рынках и типах подключений, то, в зависимости от подключения, данный приказ может применяться только для первой ноги портфеля или же для инструментов обеих ног. На данный момент отправка такой команды реализована для FIX-подключений фондового и валютного рынков Московской биржи, а так же TWIME-подключения срочного рынка Московской биржи.</p> <p>Использование приказа переместить заявку для поддерживаемых подключений не является обязательным. Эта возможность может быть отключена при создании нового транзакционного подключения.</p> <h2 id="_6-3-правила-перемещения-lim-sell-и-lim-buy" tabindex="-1"><a href="#_6-3-правила-перемещения-lim-sell-и-lim-buy" class="header-anchor">#</a> 6.3. Правила перемещения Lim_Sell и Lim_Buy <div class="anchor-container" data-v-72af3cd3><span id="правила-перемещения-lim_sell-и-lim_buy" data-v-72af3cd3></span></div></h2> <p>Сигнальные цены <a href="/bot-doc/docs/05-params-description.html#p.lim_s">Lim_Sell</a> и <a href="/bot-doc/docs/05-params-description.html#p.lim_s">Lim_Buy</a> перемещаются только при прохождении сделок по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> инструменту портфеля кроме случая использования <a href="/bot-doc/docs/05-params-description.html#p.always_limits_timer">Always timer</a>.</p> <p>Правила перемещения сигнальных цен можно разделить на две части: произошла продажа по <a href="/bot-doc/docs/05-params-description.html#is-first">Is first</a> бумаге и произошла покупка по <a href="/bot-doc/docs/05-params-description.html#is-first">Is first</a> бумаге. Внутри каждой из этих частей алгоритм делится еще на две части: позиция портфеля до прохождения данной сделки была равна нулю и была не равна нулю.</p> <p>Введем следующие обозначения: <code>diffpos</code> - знаковое количество лотов в сделке по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> бумаге, <code>V</code> - это <a href="/bot-doc/docs/05-params-description.html#p.v_in_l">v_in_left</a> × <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> или <a href="/bot-doc/docs/05-params-description.html#p.v_out_l">v_out_left</a> × <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> в зависимости от того открываем мы позицию или закрываем данной заявкой, <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> - это <code>Count</code> <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> бумаги, <a href="/bot-doc/docs/05-params-description.html#_5-3-6-curpos">Curpos</a> - текущая позиция по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> бумаге портфеля (т.е. прошедшая только что сделка еще НЕ учтена), нижний индекс 0 - предыдущее значение параметра, 1 - новое значение параметра. В данных обозначениях алгоритм перемещения сигнальных цен примет вид:</p> <ul><li><p>если прошла продажа(соответственно в количестве <code>diffpos</code>):</p> <ul><li><p>если текущая позиция до момента совершения сделки была <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">curpos\neq 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.716em;"></span><span class="strut bottom" style="height:0.9309999999999999em;vertical-align:-0.215em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">≠</span><span class="mord mathrm">0</span></span></span></span>, то:</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mn>3</mn><mo>=</mo><mrow><mo fence="true">(</mo><mi mathvariant="normal">∣</mi><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub></mrow><mi mathvariant="normal">∣</mi><mo>−</mo><mi>T</mi><mi>P</mi><mo>−</mo><mi>K</mi><mo fence="true">)</mo></mrow><mo>×</mo><mfrac><mrow><mi>V</mi></mrow><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow></mfrac><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">k3=\left(|{Lim\_Sell_0- Lim\_Buy_0}|-TP-K\right)\times\frac{V}{curpos},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.872331em;"></span><span class="strut bottom" style="height:1.3534389999999998em;vertical-align:-0.481108em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathrm">∣</span><span class="mord textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord mathrm">∣</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mbin">×</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mn>4</mn><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mi>k</mi><mn>3</mn><mo>+</mo><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>≥</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>−</mo><mi>k</mi><mn>3</mn><mo>+</mo><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">k4=
\begin{cases}k3+K2, &amp;\text{if}\enspace Lim\_Sell_0-Lim\_Buy_0\geq 0\\
        -k3+K2, &amp;\text{if}\enspace Lim\_Sell_0-Lim\_Buy_0&lt;0 
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">4</span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord">−</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≥</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mi>k</mi><mn>4</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&gt;</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>K</mi><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Buy_1= Lim\_Buy_0+\frac{|{diffpos}|}{V}\times 
\begin{cases} 
 k4, &amp;\text{if}\enspace curpos&gt;0\\ 
 K1, &amp;\text{if}\enspace curpos&lt;0 
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">4</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&gt;</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>K</mi><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Sell_1=Lim\_Sell_0+\frac{|{diffpos}|}{V}\times
\begin{cases} 
K2, &amp;\text{if}\enspace curpos&gt;0\\ 
K, &amp;\text{if}\enspace curpos&lt;0 
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p></li> <li><p>если текущая позиция до момента совершения сделки была <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">curpos=0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span>, то:</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mi>K</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Sell_1=Lim\_Sell_0+\frac{|{diffpos}|}{V}\times K,</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.01em;"></span><span class="strut bottom" style="height:1.355em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>T</mi><mi>P</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Buy_1=Lim\_Sell_0-TP,</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span></span></span></span></p></li></ul></li> <li><p>если прошла покупка (соответственно в количестве diffpos):</p> <ul><li><p>если текущая позиция до момента совершения сделки была <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">curpos\neq 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.716em;"></span><span class="strut bottom" style="height:0.9309999999999999em;vertical-align:-0.215em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">≠</span><span class="mord mathrm">0</span></span></span></span>, то:</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mn>3</mn><mo>=</mo><mrow><mo fence="true">(</mo><mi mathvariant="normal">∣</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mi mathvariant="normal">∣</mi><mo>−</mo><mi>T</mi><mi>P</mi><mo>−</mo><mi>K</mi><mo fence="true">)</mo></mrow><mo>×</mo><mfrac><mrow><mi>V</mi></mrow><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow></mfrac><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">k3=\left(|Lim\_Sell_0-Lim\_Buy_0|-TP-K\right)\times\frac{V}{curpos},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.872331em;"></span><span class="strut bottom" style="height:1.3534389999999998em;vertical-align:-0.481108em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathrm">∣</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">∣</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mbin">×</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mn>4</mn><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mo>−</mo><mi>k</mi><mn>3</mn><mo>+</mo><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>≥</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>k</mi><mn>3</mn><mo>+</mo><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">k4=
\begin{cases} 
-k3+K2, &amp;\text{if}\enspace Lim\_Sell_0-Lim\_Buy_0\geq 0\\
k3+K2, &amp;\text{if}\enspace Lim\_Sell_0-Lim\_Buy_0&lt;0
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">4</span><span class="mrel">=</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord">−</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">3</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≥</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>0</mn></msub><mo>−</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mi>k</mi><mn>4</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>K</mi><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&gt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Sell_1=Lim\_Sell_0-\frac{|{diffpos}|}{V}\times 
\begin{cases} 
k4, &amp;\text{if}\enspace curpos&lt;0\\
K1, &amp;\text{if}\enspace curpos&gt;0 
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathrm">4</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>−</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mi>K</mi><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>K</mi><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi></mtext><mspace width="0.5em"></mspace><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>&gt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Buy_1=Lim\_Buy_0-\frac{|{diffpos}|}{V}\times 
\begin{cases} 
K2, &amp;\text{if}\enspace curpos&lt;0\\
K, &amp;\text{if}\enspace curpos&gt;0 
\end{cases},</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.75em;"></span><span class="strut bottom" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="minner textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6819999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span><span style="top:0.7579999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle uncramped"><span class="text mord textstyle uncramped"><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.07778em;">f</span></span><span class="mord mspace enspace"></span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></p></li> <li><p>если текущая позиция до момента совершения сделки была <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">curpos=0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span>, то:</p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>e</mi><mi>l</mi><msub><mi>l</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>T</mi><mi>P</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">Lim\_Sell_1=Lim\_Buy_0+TP,</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.01968em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span></span></span></span></p> <p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>B</mi><mi>u</mi><msub><mi>y</mi><mn>0</mn></msub><mo>−</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mi mathvariant="normal">∣</mi></mrow><mrow><mi>V</mi></mrow></mfrac><mo>×</mo><mi>K</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">Lim\_Buy_1=Lim\_Buy_0-\frac{|{diffpos}|}{V}\times K.</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.01em;"></span><span class="strut bottom" style="height:1.355em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit">L</span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathrm" style="margin-right:0.02778em;">_</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.485em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">∣</span><span class="mord scriptstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span><span class="mord mathrm">∣</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathrm">.</span></span></span></span></p></li></ul></li></ul> <p>Также перемещение сигнальных цен происходит когда заявка не может быть выставлена из-за ограничений по <a href="/bot-doc/docs/05-params-description.html#p.v_min">v_min</a>, <a href="/bot-doc/docs/05-params-description.html#p.v_max">v_max</a>, <a href="/bot-doc/docs/05-params-description.html#p.to0">To0</a>. Если робот не может купить из-за ограничений по <a href="/bot-doc/docs/05-params-description.html#p.v_max">v_max</a>, то в соответствии с параметрами портфеля <a href="/bot-doc/docs/05-params-description.html#p.timer">Limits timer</a> и <a href="/bot-doc/docs/05-params-description.html#p.percent">Percent</a> цены <a href="/bot-doc/docs/05-params-description.html#p.lim_s">Lim_Sell</a> и <a href="/bot-doc/docs/05-params-description.html#p.lim_b">Lim_Buy</a> уменьшаются на величину параметра портфеля <a href="/bot-doc/docs/05-params-description.html#p.k">K</a>, если же робот не может продать из-за ограничений по <a href="/bot-doc/docs/05-params-description.html#p.v_min">v_min</a>, то в соответствии с параметрами портфеля <a href="/bot-doc/docs/05-params-description.html#p.timer">Limits timer</a> и <a href="/bot-doc/docs/05-params-description.html#p.percent">Percent</a> значения <a href="/bot-doc/docs/05-params-description.html#p.lim_s">Lim_Sell</a> и <a href="/bot-doc/docs/05-params-description.html#p.lim_b">Lim_Buy</a> увеличиваются на величину параметра портфеля <a href="/bot-doc/docs/05-params-description.html#p.k">K</a>.</p> <h2 id="_6-4-особенности-поведения-заявок-переставленных-по-sl-или-timer" tabindex="-1"><a href="#_6-4-особенности-поведения-заявок-переставленных-по-sl-или-timer" class="header-anchor">#</a> 6.4. Особенности поведения заявок, переставленных по SL или Timer <div class="anchor-container" data-v-72af3cd3><span id="особенности-поведения-заявок,-переставленных-по-sl-или-timer" data-v-72af3cd3></span></div></h2> <p>Если после переставления заявки по событиям <a href="/bot-doc/docs/05-params-description.html#_5-3-15-sl">SL</a> или <a href="/bot-doc/docs/05-params-description.html#_5-3-17-timer">Timer</a> новая заявка не проходит в течение 1 секунды, то она будет автоматически переставлена по цене <code>bid</code> - <a href="/bot-doc/docs/05-params-description.html#_5-3-13-k-sl">k_sl</a> на продажу или <code>offer</code> + <a href="/bot-doc/docs/05-params-description.html#_5-3-13-k-sl">k_sl</a> на покупку, вне зависимости от значений <a href="/bot-doc/docs/05-params-description.html#_5-3-15-sl">SL</a> и <a href="/bot-doc/docs/05-params-description.html#_5-3-17-timer">Timer</a> и вне зависимости от того включен ли <a href="/bot-doc/docs/05-params-description.html#_5-3-17-timer">Timer</a> вообще. Заявки, выставляемые при закрытии или выравнивании позиции (это либо настройка в расписании, либо &quot;кликер&quot; <code>To market</code>) всегда выставляются с включенным таймером и значение параметра <a href="/bot-doc/docs/05-params-description.html#_5-3-17-timer">Timer</a> для таких заявок всегда равно 1.</p> <p>При отрицательном заданном значении <a href="/bot-doc/docs/05-params-description.html#_5-3-13-k-sl">k_sl</a> вышеописанное правило отменятся, а именно: отменяется перевыставление заявки, если она не проходила в течении 1 секунды. При этом логика работы остальных параметров, в том числе <a href="/bot-doc/docs/05-params-description.html#p.use_tt">Timetable</a>, не изменилась.</p> <h2 id="_6-5-подсчет-финансового-результата" tabindex="-1"><a href="#_6-5-подсчет-финансового-результата" class="header-anchor">#</a> 6.5. Подсчёт финансового результата <div class="anchor-container" data-v-72af3cd3><span id="подсчёт-финансового-результата" data-v-72af3cd3></span></div></h2> <p>Финансовый результат (в смысле просто число) считается по сделкам и никаких &quot;экзотических&quot; случаев, связанных с его подсчетом нет. НО есть случаи когда не будет раздвижки в таблице финансовых результатов. Нужно запомнить главное правило, чтобы была раздвижка, должна быть сделка по главной бумаге, если ее нет, то и раздвижки нет. То есть, если у вас по какой-то причине &quot;кривая&quot; позиция и вы ее &quot;подровняли&quot;, нажав на кнопку <code>To market</code>, то вы не получите нормальной раздвижки в данной таблице. У вас будет только одна &quot;кривая&quot; раздвижка, в которой фигурирует только главная бумага (как пример, флуд контроль, проходят сделки по первой ноге, а по второй не дают выставиться, у вас будут одноногие &quot;кривые&quot; раздвижки с первой ногой, а после нажатия To market, когда пройдут сделки, т.к. они были только по второй ноге, то раздвижки в таблице не будет, но с финансовым результатом все будет в порядке).</p> <p>И еще один вариант, когда значение параметра <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> первой ноги больше значения параметра  <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> второй. Пусть вы торгуете долларом валюты против доллара на срочном рынке, и валюта первая нога. Т.е. <a href="/bot-doc/docs/05-params-description.html#_5-3-8-count">Count</a> у валюты 100, а у срочки 1, и вы перекрываете на срочке каждые 100 контрактов валютки. Вы выставили 100 контрактов на валютке. Предположим, у вас взяли 60. Раздвижки в таблице не будет, т.к. она получится заведомо &quot;кривой&quot;, вторую ногу же не кидали. Потом прошло еще 50, и вы снова не увидите раздвижки. Да, вы кините одну бумагу на срочку, она пройдет (в финансовом результате все нормально учтется). Но опять же не совсем ясно к каким сделкам ее привязывать, если привязать как обычно к последней (т.е. к 50), то будет заведомо кривая раздвижка, а искать какие-то предыдущие сделки уже не вариант, т.к. все могло быть не так просто, как в описанном примере.</p> <h2 id="_6-6-о-ценах-выставления-заявок-второи-ноги" tabindex="-1"><a href="#_6-6-о-ценах-выставления-заявок-второи-ноги" class="header-anchor">#</a> 6.6. О ценах выставления заявок второй ноги <div class="anchor-container" data-v-72af3cd3><span id="о-ценах-выставления-заявок-второй-ноги" data-v-72af3cd3></span></div></h2> <p>В момент выставлении заявки по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> инструменту запоминаются текущие цены по остальным бумагам. Таким образом в момент совершении сделки по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> инструменту все остальные бумаги в портфеле выставятся по ценам, которые робот запомнил во время выставления заявки по <a href="/bot-doc/docs/05-params-description.html#_5-3-11-is-first">Is first</a> инструменту. Исключение составляет использование параметра <a href="/bot-doc/docs/05-params-description.html#p.equal_prices">Equal price</a></p> <h2 id="_6-7-об-объемах-выставления-заявок" tabindex="-1"><a href="#_6-7-об-объемах-выставления-заявок" class="header-anchor">#</a> 6.7. Об объёмах выставления заявок <div class="anchor-container" data-v-72af3cd3><span id="об-объёмах-выставления-заявок" data-v-72af3cd3></span></div></h2> <p>Для некоторых бирж (к примеру Deribit) если объём в заявке не кратен лоту, то объем выставляемой заявки принудительно округляется до целого количества лотов(например лот равен 10, объём выставляемой заявки 25, то в действительности на бирже выставится заявка объемом 20 (округление всегда происходит в меньшую сторону)). Если при подобном округлении объём выставляемой заявки станет равным нулю, то вы получите ошибку выставления <code>REASON_ZERO_AMOUNT_TO_MULTIPLE</code>.</p> <h2 id="_6-8-участие-пользователя-во-внутренних-тестированиях-проводимых-moex" tabindex="-1"><a href="#_6-8-участие-пользователя-во-внутренних-тестированиях-проводимых-moex" class="header-anchor">#</a> 6.8. Участие пользователя во внутренних тестированиях, проводимых MOEX <div class="anchor-container" data-v-72af3cd3><span id="участие-пользователя-во-внутренних-тестированиях,-проводимых-moex" data-v-72af3cd3></span></div></h2> <p>Клиент может принимать участвовать в тестированиях, которые проводит Московская биржа на тестовом контуре (полигоне). Предварительно необходимо предупредить об этом техподдержку.</p> <h2 id="_6-9-алгоритм-робота-в-синтетических-стаканах" tabindex="-1"><a href="#_6-9-алгоритм-робота-в-синтетических-стаканах" class="header-anchor">#</a> 6.9. Алгоритм робота в синтетических стаканах <div class="anchor-container" data-v-72af3cd3><span id="алгоритм-робота-в-синтетических-стаканах" data-v-72af3cd3></span></div></h2> <p>При торгах Московская биржа применяет синтетические стаканы: https://www.moex.com/ru/spreads/ , цены и объёмы которых видит пользователь в своем терминале брокера. Однако, робот работает только с реальными ценами и объемами того стакана, который указан в инструментах портфеля. Поэтому синтетические цены он не видит. Это происходит из-за того, что робот получает маркет дату по самому быстрому подключению Orderlog с биржи, а терминал брокера использует другие данные для построения стакана. Таким образом получается, что в стакане робота по календарным спредам отображаются только те заявки, которые были выставлены непосредственно по инструменту календарный спред. В Quik кроме этого будут синтетические котировки, сформированные из стаканов ближнего и дальнего фьючерсов.</p> <h2 id="_6-10-сделки-с-отметкои-aggregated" tabindex="-1"><a href="#_6-10-сделки-с-отметкои-aggregated" class="header-anchor">#</a> 6.10. Сделки с отметкой Aggregated <div class="anchor-container" data-v-72af3cd3><span id="сделки-с-отметкой-aggregated" data-v-72af3cd3></span></div></h2> <p>Робот не всегда берет точное количество и цену каждой сделки по отдельно взятой заявке. Например, одна конкретная заявка свелась в сделки (их может быть несколько), но подтверждение об исполнеии этой заявки мы получили раньше, чем по каждой сделке. В таком случае в наших таблицах вы никогда не найдете информацию об этих сделках, будет только одна общая. Такие сделки отмечены в виджете <code>Deals for today</code> и <code>Deals history</code> как <code>Aggregated</code>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bot-doc/docs/05-params-description.html" class="prev">
        5. Описание параметров
      </a></span> <span class="next"><a href="/bot-doc/docs/07-order-error.html">
        7. Ошибки заявок
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/bot-doc/assets/js/app.e81ab8fa.js" defer></script><script src="/bot-doc/assets/js/3.5b3b6265.js" defer></script><script src="/bot-doc/assets/js/16.9bde9826.js" defer></script><script src="/bot-doc/assets/js/10.8c8ad779.js" defer></script>
  </body>
</html>
